function trim(e){return(e||"").replace(/^\s+|\s+$/g,"")}module.exports=function(e,t){function i(e){var t=e.match(/\n/g);t&&(n+=t.length);var i=e.lastIndexOf("\n");r=~i?e.length-i:r+e.length}function s(){var e={line:n,column:r};return t.position?function(t){t.position={start:e,end:{line:n,column:r}};p();return t}:o}function o(e){p();return e}function u(t){var i=new Error(t+" near line "+n+":"+r);i.line=n;i.column=r;i.source=e;throw i}function a(){return{type:"stylesheet",stylesheet:{rules:c()}}}function f(){return h(/^{\s*/)}function l(){return h(/^}/)}function c(){var t,n=[];p();d(n);while(e.charAt(0)!="}"&&(t=A()||O())){n.push(t);d(n)}return n}function h(t){var n=t.exec(e);if(!n)return;var r=n[0];i(r);e=e.slice(r.length);return n}function p(){h(/^\s*/)}function d(e){var t;e=e||[];while(t=v())e.push(t);return e}function v(){var t=s();if("/"!=e.charAt(0)||"*"!=e.charAt(1))return;var n=2;while(null!=e.charAt(n)&&("*"!=e.charAt(n)||"/"!=e.charAt(n+1)))++n;n+=2;var o=e.slice(2,n-2);r+=2;i(o);e=e.slice(n);r+=2;return t({type:"comment",comment:o})}function m(){var e=h(/^([^{]+)/);if(!e)return;return trim(e[0]).split(/\s*,\s*/)}function g(){var e=s(),t=h(/^(\*?[-\/\*\w]+)\s*/);if(!t)return;t=trim(t[0]);if(!h(/^:\s*/))return u("property missing ':'");var n=h(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/);if(!n)return u("property missing value");var r=e({type:"declaration",property:t,value:trim(n[0])});h(/^[;\s]*/);return r}function y(){var e=[];if(!f())return u("missing '{'");d(e);var t;while(t=g()){e.push(t);d(e)}return l()?e:u("missing '}'")}function b(){var e,t=[],n=s();while(e=h(/^(from|to|\d+%|\.\d+%|\d+\.\d+%)\s*/)){t.push(e[1]);h(/^,\s*/)}if(!t.length)return;return n({type:"keyframe",values:t,declarations:y()})}function w(){var e=s(),t=h(/^@([-\w]+)?keyframes */);if(!t)return;var n=t[1],t=h(/^([-\w]+)\s*/);if(!t)return u("@keyframes missing name");var r=t[1];if(!f())return u("@keyframes missing '{'");var i,o=d();while(i=b()){o.push(i);o=o.concat(d())}return l()?e({type:"keyframes",name:r,vendor:n,keyframes:o}):u("@keyframes missing '}'")}function E(){var e=s(),t=h(/^@supports *([^{]+)/);if(!t)return;var n=trim(t[1]);if(!f())return u("@supports missing '{'");var r=d().concat(c());return l()?e({type:"supports",supports:n,rules:r}):u("@supports missing '}'")}function S(){var e=s(),t=h(/^@media *([^{]+)/);if(!t)return;var n=trim(t[1]);if(!f())return u("@media missing '{'");var r=d().concat(c());return l()?e({type:"media",media:n,rules:r}):u("@media missing '}'")}function x(){var e=s(),t=h(/^@page */);if(!t)return;var n=m()||[];if(!f())return u("@page missing '{'");var r=d(),i;while(i=g()){r.push(i);r=r.concat(d())}return l()?e({type:"page",selectors:n,declarations:r}):u("@page missing '}'")}function T(){var e=s(),t=h(/^@([-\w]+)?document *([^{]+)/);if(!t)return;var n=trim(t[1]),r=trim(t[2]);if(!f())return u("@document missing '{'");var i=d().concat(c());return l()?e({type:"document",document:r,vendor:n,rules:i}):u("@document missing '}'")}function N(){return L("import")}function C(){return L("charset")}function k(){return L("namespace")}function L(e){var t=s(),n=h(new RegExp("^@"+e+" *([^;\\n]+);"));if(!n)return;var r={type:e};r[e]=trim(n[1]);return t(r)}function A(){return w()||S()||E()||N()||C()||k()||T()||x()}function O(){var e=s(),t=m();if(!t)return;d();return e({type:"rule",selectors:t,declarations:y()})}t=t||{};var n=1,r=1;return a()};