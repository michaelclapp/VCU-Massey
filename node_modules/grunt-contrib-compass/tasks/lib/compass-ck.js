exports.init=function(e){"use strict";function u(e){return e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase()}var t=require("fs"),n=require("tmp"),r=require("dargs"),i=require("path"),s=require("async"),o={};o.extractRawOptions=function(t){var n=t.raw||"",r=["http_path","css_path","http_stylesheets_path","sass_path","images_path","http_images_path","generated_images_dir","generated_images_path","http_generated_images_path","javascripts_path","http_javascripts_path","fonts_path","http_fonts_path","http_fonts_dir","extensions_dir","extension_path"],i=Object.keys(t).filter(function(e){var i=u(e);if(r.indexOf(i)>=0){var s=t[e].replace(/"/,'\\"');n+=i+' = "'+s+'"\n';delete t[e];return!0}if(i==="asset_cache_buster"){t[e]===!1&&(n+=i+" :none");delete t[e];return!0}});return{raw:n,options:i}};o.buildBannerCallback=function(e,t){if(!t.specify||!t.banner){t.banner&&!t.specify&&e.fail.warn("You can only use the `banner` option in combination with `specify.`");return function(){}}var n=e.file.expand({filter:function(e){return i.basename(e)[0]!=="_"}},t.specify),r=t.banner;delete t.banner;var o=n.map(function(e){return e.replace(t.sassDir,t.cssDir).replace(/\.(css\.)?(scss|sass)$/i,".css")});return function(){e.log.verbose.writeln("Writing CSS banners.");s.map(o,function(t){e.log.verbose.writeln("Writing CSS banner for "+t);var n=e.file.read(t);e.file.write(t,r+e.util.linefeed+n)})}};o.buildConfigContext=function(r){var i=o.extractRawOptions(r);r.raw&&r.config&&e.fail.warn("The options `raw` and `config` are mutually exclusive");i.options.length>0&&r.config&&e.fail.warn("The option `config` cannot be combined with these options: "+i.options.join(", ")+".");return function(r){i.raw?n.file(function(e,n,s){if(e)return r(e);t.writeSync(s,new Buffer(i.raw),0,i.raw.length);r(null,n)}):r(null,null)}};o.buildArgsArray=function(t){var n=["compile"];t.clean?n=["clean"]:t.watch&&(n=["watch"]);var s=t.basePath;e.verbose.writeflags(t,"Options");process.platform==="win32"?n.unshift("compass.bat"):n.unshift("compass");t.bundleExec&&n.unshift("bundle","exec");t.basePath&&n.push(t.basePath);if(t.specify){var o=e.file.expand({filter:function(e){return i.basename(e)[0]!=="_"}},t.specify);if(!(o.length>0))return e.log.writeln("`specify` option used, but no files were found.");[].push.apply(n,o)}[].push.apply(n,r(t,["raw","clean","bundleExec","basePath","specify","watch"]));t.importPath&&(n=n.map(function(e){return e.replace("--import-path","-I")}));e.option("no-color")&&n.push("--boring");return n};return o};