/*!
 * Tmp
 *
 * Copyright (c) 2011-2013 KARASZI Istvan <github@spam.raszi.hu>
 *
 * MIT Licensed
 *//**
 * Module dependencies.
 */function _getTMPDir(){var e=["TMPDIR","TMP","TEMP"];for(var t=0,n=e.length;t<n;t++){if(_isUndefined(process.env[e[t]]))continue;return process.env[e[t]]}return"/tmp"}function _isUndefined(e){return typeof e=="undefined"}function _parseArguments(e,t){if(!t||typeof t!="function"){t=e;e={}}return[e,t]}function _getTmpName(e,t){function a(){if(!o){var e=[_isUndefined(r.prefix)?"tmp-":r.prefix,process.pid,(Math.random()*68719476736).toString(36),r.postfix].join("");return path.join(r.dir||_TMP,e)}var t=[];for(var n=0;n<6;n++)t.push(randomChars.substr(Math.floor(Math.random()*randomCharsLength),1));return s.replace(/XXXXXX/,t.join(""))}var n=_parseArguments(e,t),r=n[0],i=n[1],s=r.template,o=!_isUndefined(s),u=r.tries||3;if(isNaN(u)||u<0)return i(new Error("Invalid tries"));if(o&&!s.match(/XXXXXX/))return i(new Error("Invalid template provided"));(function f(){var e=a();exists(e,function(n){if(n)return u-->0?f():i(new Error("Could not get a unique tmp filename, max tries reached"));i(null,e)})})()}function _createTmpFile(e,t){var n=_parseArguments(e,t),r=n[0],i=n[1];r.postfix=_isUndefined(r.postfix)?".tmp":r.postfix;_getTmpName(r,function(t,n){if(t)return i(t);fs.open(n,_c.O_CREAT|_c.O_EXCL|_c.O_RDWR,r.mode||384,function(t,s){if(t)return i(t);r.keep||_removeObjects.unshift([fs.unlinkSync,n]);i(null,n,s)})})}function _rmdirRecursiveSync(e){var t=fs.readdirSync(e);for(var n=0,r=t.length;n<r;n++){var i=path.join(e,t[n]),s=fs.lstatSync(i);s.isDirectory()?_rmdirRecursiveSync(i):fs.unlinkSync(i)}fs.rmdirSync(e)}function _createTmpDir(e,t){var n=_parseArguments(e,t),r=n[0],i=n[1];_getTmpName(r,function(t,n){if(t)return i(t);fs.mkdir(n,r.mode||448,function(t){if(t)return i(t);r.keep||(r.unsafeCleanup?_removeObjects.unshift([_rmdirRecursiveSync,n]):_removeObjects.unshift([fs.rmdirSync,n]));i(null,n)})})}function _garbageCollector(){if(_uncaughtException&&!_gracefulCleanup)return;for(var e=0,t=_removeObjects.length;e<t;e++)try{_removeObjects[e][0].call(null,_removeObjects[e][1])}catch(n){}}function _setGracefulCleanup(){_gracefulCleanup=!0}var fs=require("fs"),path=require("path"),os=require("os"),exists=fs.exists||path.exists,tmpDir=os.tmpDir||_getTMPDir,_c=require("constants"),_TMP=tmpDir(),randomChars="0123456789ABCDEFGHIJKLMNOPQRSTUVWXTZabcdefghiklmnopqrstuvwxyz",randomCharsLength=randomChars.length,_removeObjects=[],_gracefulCleanup=!1,_uncaughtException=!1;process.addListener("uncaughtException",function(t){_uncaughtException=!0;_garbageCollector();throw t});process.addListener("exit",function(){_garbageCollector()});module.exports.tmpdir=_TMP;module.exports.dir=_createTmpDir;module.exports.file=_createTmpFile;module.exports.tmpName=_getTmpName;module.exports.setGracefulCleanup=_setGracefulCleanup;