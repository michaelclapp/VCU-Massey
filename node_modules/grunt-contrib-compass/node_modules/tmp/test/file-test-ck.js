function _testFile(e,t){return function(r,i,s){assert.ok(existsSync(i),"should exist");var o=fs.statSync(i);assert.equal(o.size,0,"should have zero size");assert.ok(o.isFile(),"should be a file");Test.testStat(o,e);if(t){var u=fs.fstatSync(s);assert.deepEqual(u,o,"fstat results should be the same");var a=new Buffer("something");assert.equal(fs.writeSync(s,a,0,a.length,0),a.length,"should be writable");assert.ok(!fs.closeSync(s),"should not return with error")}}}var vows=require("vows"),assert=require("assert"),path=require("path"),fs=require("fs"),existsSync=fs.existsSync||path.existsSync,tmp=require("../lib/tmp.js"),Test=require("./base.js");vows.describe("File creation").addBatch({"when using without parameters":{topic:function(){tmp.file(this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":_testFile(33152,!0),"should have the default prefix":Test.testPrefix("tmp-"),"should have the default postfix":Test.testPostfix(".tmp")},"when using with prefix":{topic:function(){tmp.file({prefix:"something"},this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":_testFile(33152,!0),"should have the provided prefix":Test.testPrefix("something")},"when using with postfix":{topic:function(){tmp.file({postfix:".txt"},this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":_testFile(33152,!0),"should have the provided postfix":Test.testPostfix(".txt")},"when using template":{topic:function(){tmp.file({template:path.join(tmp.tmpdir,"clike-XXXXXX-postfix")},this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":_testFile(33152,!0),"should have the provided prefix":Test.testPrefix("clike-"),"should have the provided postfix":Test.testPostfix("-postfix")},"when using multiple options":{topic:function(){tmp.file({prefix:"foo",postfix:"bar",mode:416},this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":_testFile(33184,!0),"should have the provided prefix":Test.testPrefix("foo"),"should have the provided postfix":Test.testPostfix("bar")},"when using multiple options and mode":{topic:function(){tmp.file({prefix:"complicated",postfix:"options",mode:420},this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":_testFile(33188,!0),"should have the provided prefix":Test.testPrefix("complicated"),"should have the provided postfix":Test.testPostfix("options")},"no tries":{topic:function(){tmp.file({tries:-1},this.callback)},"should not be created":assert.isObject},"keep testing":{topic:function(){Test.testKeep("file","1",this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should be a file":function(e,t){_testFile(33152,!1)(e,t,null);fs.unlinkSync(t)}},"unlink testing":{topic:function(){Test.testKeep("file","0",this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should not exist":function(e,t){assert.ok(!existsSync(t),"File should be removed")}},"non graceful testing":{topic:function(){Test.testGraceful("file","0",this.callback)},"should not return with error":assert.isNull,"should return with a name":Test.assertName,"should be a file":function(e,t){_testFile(33152,!1)(e,t,null);fs.unlinkSync(t)}},"graceful testing":{topic:function(){Test.testGraceful("file","1",this.callback)},"should not return with an error":assert.isNull,"should return with a name":Test.assertName,"should not exist":function(e,t){assert.ok(!existsSync(t),"File should be removed")}}}).exportTo(module);