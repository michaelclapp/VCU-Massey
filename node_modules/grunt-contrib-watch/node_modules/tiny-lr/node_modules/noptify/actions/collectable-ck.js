var fs=require("fs"),collectable=module.exports;collectable.stdin=function(t,n){n||(n=t,t=!1);var r=this.nopt.argv,i=this;n=n||function(e){e&&i.emit("error",e)};this._readFromStdin=!0;if(!r){this.once("stdin",n);return this}(!r.remain.length||t)&&this.readStdin(n);return this};collectable.files=function(t){var n=this.nopt.argv,r=this;t=t||function(e){e&&r.emit("error",e)};if(!n){this.once("files",t);return this}n.remain.length&&this.readFiles(n.remain,t);return this};collectable.readStdin=function(t){var n="",r=this;process.stdin.setEncoding("utf8");process.stdin.on("error",t);process.stdin.on("data",function(e){n+=e;r.emit("stdin:data",e)}).on("end",function(){r.emit("stdin",null,n);t(null,n)}).resume();return this};collectable.readFiles=function(t,n){var r="",i=this,s=t.slice(0);(function o(e){if(!e){i.emit("files",null,r,t);return n(null,r,t)}fs.readFile(e,"utf8",function(e,t){if(e)return n(e);r+=t;i.emit("files:data",t);o(s.shift())})})(s.shift());return this};collectable.collect=function(t){return this.stdin(t).files(t)};