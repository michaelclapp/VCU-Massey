var nopt=require("nopt"),commandable=module.exports;commandable.cmd=commandable.command=function(t,n){this._commands[t]=n;var r=n&&n.command&&n.route&&n.parse;this.on(t,r?function(e,t,r){n.parse(e,r)}:n);return this};commandable.route=function(t,n){t=t instanceof RegExp?t:new RegExp("^"+t+"$");this._routes.push({pattern:t,fn:n});return this};commandable.routeCommand=function(t){t=t||this.nopt;var n=t.argv.remain,r=Object.keys(this._commands),i=this._routes.filter(function(e){return e.pattern.test(n.join(" "))});if(i.length)return i[0].fn();var s=0,o=n.filter(function(e,t){var n=~r.indexOf(e);n&&(s=s||t);return n});if(!o[0])return this.run();t.argv.remain=n.slice(0,s);o.forEach(function(e){var n=t.argv.original.indexOf(e)+1,r=nopt({},{},t.argv.original,n);this.emit(e,r.argv.original,r,n)},this)};commandable.registered=function(e){var t=Object.keys(this._commands),n=e.filter(function(e,n){return~t.indexOf(e)});return n.length?this._commands[n]:!1};