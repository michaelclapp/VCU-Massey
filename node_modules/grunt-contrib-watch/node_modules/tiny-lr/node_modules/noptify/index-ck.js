function noptify(e,t){return new Noptify(e,t)}function Noptify(e,t){events.EventEmitter.call(this);t=this.options=t||{};this.args=e||process.argv;this._program=t.program||path.basename(this.args[this.args[0]==="node"?1:0]);this._shorthands={};this._commands={};this._routes=[];this._steps=[];this.nopt={};this.option("help","-h","Show help usage");this.option("version","-v","Show package version")}function pad(e,t){var n=t-e.length;return n>0?e+(new Array(n)).join(" "):e}var fs=require("fs"),path=require("path"),nopt=require("nopt"),util=require("./util"),events=require("events"),collectable=require("./actions/collectable"),commandable=require("./actions/commandable");module.exports=noptify;noptify.Noptify=Noptify;util.inherits(Noptify,events.EventEmitter);util.extend(Noptify.prototype,collectable);util.extend(Noptify.prototype,commandable);Noptify.prototype.parse=function(t,n){t=t||this.args;var r=this._options.reduce(function(e,t){e[t.name]=t.type;return e},{});this._options.forEach(function(e){if(!e.shorthand)return;this.shorthand(e.shorthand,"--"+e.name)},this);var i=nopt(r,this._shorthands,t,n);if(i.version){console.log(this._version);process.exit(0)}var s=this.registered(i.argv.remain);if(i.help){s&&s.help?s.help().emit("help"):this.help().emit("help");process.exit(0)}this.nopt=i;this.routeCommand&&process.nextTick(this.routeCommand.bind(this));this.stdin&&this._readFromStdin&&process.nextTick(this.stdin.bind(this));return i};Noptify.prototype.version=function(t){this._version=t;return this};Noptify.prototype.program=function(t){this._program=t||"";return this};Noptify.prototype.option=function(t,n,r,i){this._options=this._options||[];if(!r){r=n;n=""}if(!i)if(typeof r=="function"){i=r;r=n;n=""}else i=String;n=n.replace(/^-*/,""),this._options.push({name:t,shorthand:n.replace(/^-*/,""),description:r||t+": "+i.name,usage:(n?"-"+n+", ":"")+"--"+t,type:i});return this};Noptify.prototype.shorthand=Noptify.prototype.shorthands=function(t,n){if(typeof t=="string"&&n){this._shorthands[t]=n;return this}Object.keys(t).forEach(function(e){this._shorthands[e]=t[e]},this);return this};Noptify.prototype.help=function(){var t="";t+="\n  Usage: "+this._program+" [options]";t+="\n";t+="\n  Options:\n";var n=Math.max.apply(Math,this._options.map(function(e){return e.usage.length})),r=this._options.map(function(e){return"    "+pad(e.usage,n+5)+"	- "+e.description});t+=r.join("\n");var i=Object.keys(this._shorthands);if(i.length){t+="\n\n  Shorthands:\n";n=Math.max.apply(Math,Object.keys(this._shorthands).map(function(e){return e.length}));t+=Object.keys(this._shorthands).map(function(e){return"    --"+pad(e,n+1)+"		"+this._shorthands[e]},this).join("\n")}t+="\n";console.log(t);return this};Noptify.prototype.run=function(t){if(t){this._steps.push(t);return this}if(!this.nopt.argv)return this.parse();var n=this._steps,r=this;(function i(e){if(!e)return;var t=/function\s*\(\w+/.test(e+"");if(!t){e();return i(n.shift())}e(function(e){if(e)return r.emit("error",e);i(n.shift())})})(n.shift())};