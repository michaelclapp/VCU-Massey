require("jsclass");var WebSocket=require("../lib/faye/websocket"),fs=require("fs"),http=require("http"),https=require("https");JS.ENV.EchoServer=function(){};EchoServer.prototype.listen=function(e,t){var n=t?https.createServer({key:fs.readFileSync(__dirname+"/server.key"),cert:fs.readFileSync(__dirname+"/server.crt")}):http.createServer();n.addListener("upgrade",function(e,t,n){var r=new WebSocket(e,t,n,["echo"]);r.onmessage=function(e){r.send(e.data)}});this._httpServer=n;n.listen(e)};EchoServer.prototype.stop=function(e,t){this._httpServer.addListener("close",function(){e&&e.call(t)});this._httpServer.close()};JS.Packages(function(){with(this)autoload(/.*Spec/,{from:"spec/faye/websocket"})});JS.require("JS.Test",function(){JS.Test.Unit.Assertions.define("assertBufferEqual",function(e,t){this.assertEqual(e.length,t.length);var n=[],r=t.length;while(r--)n[r]=t[r];this.assertEqual(e,n)});JS.require("ClientSpec","Draft75ParserSpec","Draft76ParserSpec","HybiParserSpec",JS.Test.method("autorun"))});