var WebSocket=require("../lib/faye/websocket"),pace=require("pace"),host="ws://localhost:9001",agent="Node "+process.version,cases=0,skip=[],socket=new WebSocket.Client(host+"/getCaseCount"),progress;socket.onmessage=function(e){console.log("Total cases to run: "+e.data);cases=parseInt(e.data);progress=pace(cases)};socket.onclose=function(){var e=function(t){progress.op();if(t>cases){socket=new WebSocket.Client(host+"/updateReports?agent="+encodeURIComponent(agent));socket.onclose=process.exit}else if(skip.indexOf(t)>=0)e(t+1);else{socket=new WebSocket.Client(host+"/runCase?case="+t+"&agent="+encodeURIComponent(agent));socket.onmessage=function(e){socket.send(e.data)};socket.onclose=function(){e(t+1)}}};e(1)};