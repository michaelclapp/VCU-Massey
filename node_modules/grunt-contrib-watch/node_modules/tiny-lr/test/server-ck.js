var request=require("supertest"),assert=require("assert"),Server=require("..").Server;describe("tiny-lr",function(){beforeEach(function(){this.app=new Server;this.server=this.app.server});describe("GET /",function(){it("respond with nothing, but respond",function(e){request(this.server).get("/").expect("Content-Type",/json/).expect(/\{"tinylr":"Welcome","version":"0.0.[\d]+"\}/).expect(200,e)});it("unknown route respond with proper 404 and error message",function(e){request(this.server).get("/whatev").expect("Content-Type",/json/).expect('{"error":"not_found","reason":"no such route"}').expect(404,e)})});describe("GET /changed",function(){it("with no clients, no files",function(e){request(this.server).get("/changed").expect("Content-Type",/json/).expect(/"clients":\[\]/).expect(/"files":\[\]/).expect(200,e)});it("with no clients, some files",function(e){request(this.server).get("/changed?files=gonna.css,test.css,it.css").expect("Content-Type",/json/).expect('{"clients":[],"files":["gonna.css","test.css","it.css"]}').expect(200,e)})});describe("POST /changed",function(){it("with no clients, no files",function(e){request(this.server).post("/changed").expect("Content-Type",/json/).expect(/"clients":\[\]/).expect(/"files":\[\]/).expect(200,e)});it("with no clients, some files",function(e){var t={clients:[],files:["cat.css","sed.css","ack.js"]};request(this.server).post("/changed").send({files:t.files}).expect("Content-Type",/json/).expect(JSON.stringify(t)).expect(200,e)})});describe("GET /livereload.js",function(){it("respond with livereload script",function(e){request(this.server).get("/livereload.js").expect(/LiveReload/).expect(200,e)})});describe("GET /kill",function(){it("shutdown the server",function(e){var t=this.server;request(t).get("/kill").expect(200,function(n){if(n)return e(n);assert.ok(!t._handle);e()})})})});