/*
 * grunt-contrib-watch
 * http://gruntjs.com/
 *
 * Copyright (c) 2013 "Cowboy" Ben Alman, contributors
 * Licensed under the MIT license.
 */"use strict";var path=require("path"),EE=require("events").EventEmitter,util=require("util");module.exports=function(e){function n(e){this.name=e.name||0;this.files=e.files||[];this.tasks=e.tasks||[];this.options=e.options;this.startedAt=!1;this.spawned=null;this.changedFiles=Object.create(null);typeof this.tasks=="string"&&(this.tasks=[this.tasks])}var t=require("./livereload")(e);n.prototype.run=function(t){var n=this;if(n.startedAt!==!1)return;n.startedAt=Date.now();if(n.tasks.length<1)return t();if(n.options.spawn===!1||n.options.nospawn===!0){e.task.run(n.tasks);t()}else n.spawned=e.util.spawn({grunt:!0,opts:{cwd:n.options.cwd,stdio:"inherit"},args:n.tasks.concat(n.options.cliArgs||[])},function(e,r,i){n.spawned=null;t()})};n.prototype.complete=function(){var e=Date.now()-this.startedAt;this.startedAt=!1;if(this.spawned){this.spawned.kill("SIGINT");this.spawned=null}this.livereload&&this.livereload.trigger(Object.keys(this.changedFiles));return e};return n};