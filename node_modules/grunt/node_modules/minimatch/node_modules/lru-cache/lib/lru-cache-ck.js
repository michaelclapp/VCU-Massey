(function(){function e(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function t(){return 1}function n(i){function m(e,t){var n=l[e];if(n){if(a&&Date.now()-n.now>a){w(n);u||(n=undefined)}else t&&g(n);n&&(n=n.value)}return n}function g(e){b(e);e.lu=h++;c[e.lu]=e}function y(){while(p<h&&d>s)w(c[p])}function b(e){delete c[e.lu];while(p<h&&!c[p])p++}function w(e){if(e){f&&f(e.key,e.value);d-=e.length;v--;delete l[e.key];b(e)}}if(!(this instanceof n))return new n(i);var s;if(typeof i=="number"){s=i;i={max:s}}i||(i={});s=i.max;var o=i.length||t;typeof o!="function"&&(o=t);if(!s||typeof s!="number"||s<=0)s=Infinity;var u=i.stale||!1,a=i.maxAge||null,f=i.dispose,l=Object.create(null),c=Object.create(null),h=0,p=0,d=0,v=0;Object.defineProperty(this,"max",{set:function(e){if(!e||typeof e!="number"||e<=0)e=Infinity;s=e;d>s&&y()},get:function(){return s},enumerable:!0});Object.defineProperty(this,"lengthCalculator",{set:function(e){if(typeof e!="function"){o=t;d=v;for(var n in l)l[n].length=1}else{o=e;d=0;for(var n in l){l[n].length=o(l[n].value);d+=l[n].length}}d>s&&y()},get:function(){return o},enumerable:!0});Object.defineProperty(this,"length",{get:function(){return d},enumerable:!0});Object.defineProperty(this,"itemCount",{get:function(){return v},enumerable:!0});this.forEach=function(e,t){t=t||this;var n=0;for(var r=h-1;r>=0&&n<v;r--)if(c[r]){n++;var i=c[r];if(a&&Date.now()-i.now>a){w(i);u||(i=undefined)}i&&e.call(t,i.value,i.key,this)}};this.keys=function(){var e=new Array(v),t=0;for(var n=h-1;n>=0&&t<v;n--)if(c[n]){var r=c[n];e[t++]=r.key}return e};this.values=function(){var e=new Array(v),t=0;for(var n=h-1;n>=0&&t<v;n--)if(c[n]){var r=c[n];e[t++]=r.value}return e};this.reset=function(){if(f)for(var e in l)f(e,l[e].value);l={};c={};p=0;h=0;d=0;v=0};this.dump=function(){return l};this.dumpLru=function(){return c};this.set=function(t,n){if(e(l,t)){f&&f(t,l[t].value);a&&(l[t].now=Date.now());l[t].value=n;this.get(t);return!0}var i=o(n),u=a?Date.now():0,p=new r(t,n,h++,i,u);if(p.length>s){f&&f(t,n);return!1}d+=p.length;c[p.lu]=l[t]=p;v++;d>s&&y();return!0};this.has=function(t){if(!e(l,t))return!1;var n=l[t];return a&&Date.now()-n.now>a?!1:!0};this.get=function(e){return m(e,!0)};this.peek=function(e){return m(e,!1)};this.del=function(e){w(l[e])}}function r(e,t,n,r,i){this.key=e;this.value=t;this.lu=n;this.length=r;this.now=i}typeof module=="object"&&module.exports?module.exports=n:this.LRUCache=n})();