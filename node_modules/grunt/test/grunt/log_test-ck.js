"use strict";var grunt=require("../../lib/grunt"),log=grunt.log,fooBuffer=new Buffer("foo"),hooker=grunt.util.hooker,stdoutEqual=function(e,t,n){var r="";hooker.hook(process.stdout,"write",{pre:function(e){r+=log.uncolor(e);return hooker.preempt()}});t();hooker.unhook(process.stdout,"write");e.equal(r,n)};exports.log={setUp:function(e){log.muted=!1;grunt.fail.errorcount=0;e()},write:function(e){e.expect(4);stdoutEqual(e,function(){log.write("")},"");stdoutEqual(e,function(){log.write("foo")},"foo");stdoutEqual(e,function(){log.write("%s","foo")},"foo");stdoutEqual(e,function(){log.write(fooBuffer)},"foo");e.done()},writeln:function(e){e.expect(4);stdoutEqual(e,function(){log.writeln()},"\n");stdoutEqual(e,function(){log.writeln("foo")},"foo\n");stdoutEqual(e,function(){log.writeln("%s","foo")},"foo\n");stdoutEqual(e,function(){log.writeln(fooBuffer)},"foo\n");e.done()},warn:function(e){e.expect(5);stdoutEqual(e,function(){log.warn()},"ERROR\n");stdoutEqual(e,function(){log.warn("foo")},">> foo\n");stdoutEqual(e,function(){log.warn("%s","foo")},">> foo\n");stdoutEqual(e,function(){log.warn(fooBuffer)},">> foo\n");e.equal(grunt.fail.errorcount,0);e.done()},error:function(e){e.expect(5);stdoutEqual(e,function(){log.error()},"ERROR\n");stdoutEqual(e,function(){log.error("foo")},">> foo\n");stdoutEqual(e,function(){log.error("%s","foo")},">> foo\n");stdoutEqual(e,function(){log.error(fooBuffer)},">> foo\n");e.equal(grunt.fail.errorcount,4);e.done()},ok:function(e){e.expect(4);stdoutEqual(e,function(){log.ok()},"OK\n");stdoutEqual(e,function(){log.ok("foo")},">> foo\n");stdoutEqual(e,function(){log.ok("%s","foo")},">> foo\n");stdoutEqual(e,function(){log.ok(fooBuffer)},">> foo\n");e.done()},errorlns:function(e){e.expect(2);stdoutEqual(e,function(){log.errorlns(grunt.util._.repeat("foo",30," "))},">> "+grunt.util._.repeat("foo",19," ")+"\n"+">> "+grunt.util._.repeat("foo",11," ")+"\n");e.equal(grunt.fail.errorcount,1);e.done()},oklns:function(e){e.expect(1);stdoutEqual(e,function(){log.oklns(grunt.util._.repeat("foo",30," "))},">> "+grunt.util._.repeat("foo",19," ")+"\n"+">> "+grunt.util._.repeat("foo",11," ")+"\n");e.done()},success:function(e){e.expect(4);stdoutEqual(e,function(){log.success()},"\n");stdoutEqual(e,function(){log.success("foo")},"foo\n");stdoutEqual(e,function(){log.success("%s","foo")},"foo\n");stdoutEqual(e,function(){log.success(fooBuffer)},"foo\n");e.done()},fail:function(e){e.expect(4);stdoutEqual(e,function(){log.fail()},"\n");stdoutEqual(e,function(){log.fail("foo")},"foo\n");stdoutEqual(e,function(){log.fail("%s","foo")},"foo\n");stdoutEqual(e,function(){log.fail(fooBuffer)},"foo\n");e.done()},header:function(e){e.expect(4);stdoutEqual(e,function(){log.header()},"\n\n");stdoutEqual(e,function(){log.header("foo")},"\nfoo\n");stdoutEqual(e,function(){log.header("%s","foo")},"\nfoo\n");stdoutEqual(e,function(){log.header(fooBuffer)},"\nfoo\n");e.done()},subhead:function(e){e.expect(4);stdoutEqual(e,function(){log.subhead()},"\n\n");stdoutEqual(e,function(){log.subhead("foo")},"\nfoo\n");stdoutEqual(e,function(){log.subhead("%s","foo")},"\nfoo\n");stdoutEqual(e,function(){log.subhead(fooBuffer)},"\nfoo\n");e.done()},debug:function(e){e.expect(5);var t=grunt.option("debug");grunt.option("debug",!0);stdoutEqual(e,function(){log.debug()},"[D] \n");stdoutEqual(e,function(){log.debug("foo")},"[D] foo\n");stdoutEqual(e,function(){log.debug("%s","foo")},"[D] foo\n");stdoutEqual(e,function(){log.debug(fooBuffer)},"[D] foo\n");grunt.option("debug",!1);stdoutEqual(e,function(){log.debug("foo")},"");grunt.option("debug",t);e.done()},writetableln:function(e){e.expect(1);stdoutEqual(e,function(){log.writetableln([10],[grunt.util._.repeat("foo",10)])},"foofoofoof\noofoofoofo\nofoofoofoo\n");e.done()},writelns:function(e){e.expect(1);stdoutEqual(e,function(){log.writelns(grunt.util._.repeat("foo",30," "))},grunt.util._.repeat("foo",20," ")+"\n"+grunt.util._.repeat("foo",10," ")+"\n");e.done()},writeflags:function(e){e.expect(1);stdoutEqual(e,function(){log.writeflags(["foo","bar"],"test")},"test: foo, bar\n");e.done()},verbose:function(e){e.expect(1);log.muted=!0;var t;["write","writeln","warn","error","ok"].forEach(function(e){t=t?t[e]("foo"):log.verbose[e]("foo")});e.strictEqual(t,log.verbose);e.done()},notverbose:function(e){e.expect(1);hooker.hook(process.stdout,"write",{pre:function(){return hooker.preempt()}});var t;["write","writeln","warn","error","ok"].forEach(function(e){t=t?t[e]("foo"):log.notverbose[e]("foo")});e.strictEqual(t,log.notverbose);hooker.unhook(process.stdout,"write");e.done()}};