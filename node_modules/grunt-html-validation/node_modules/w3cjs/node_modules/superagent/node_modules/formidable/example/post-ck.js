require("../test/common");var http=require("http"),util=require("util"),formidable=require("formidable"),server;server=http.createServer(function(e,t){if(e.url=="/"){t.writeHead(200,{"content-type":"text/html"});t.end('<form action="/post" method="post"><input type="text" name="title"><br><input type="text" name="data[foo][]"><br><input type="submit" value="Submit"></form>')}else if(e.url=="/post"){var n=new formidable.IncomingForm,r=[];n.on("error",function(e){t.writeHead(200,{"content-type":"text/plain"});t.end("error:\n\n"+util.inspect(e))}).on("field",function(e,t){console.log(e,t);r.push([e,t])}).on("end",function(){console.log("-> post done");t.writeHead(200,{"content-type":"text/plain"});t.end("received fields:\n\n "+util.inspect(r))});n.parse(e)}else{t.writeHead(404,{"content-type":"text/plain"});t.end("404")}});server.listen(TEST_PORT);console.log("listening on http://localhost:"+TEST_PORT+"/");