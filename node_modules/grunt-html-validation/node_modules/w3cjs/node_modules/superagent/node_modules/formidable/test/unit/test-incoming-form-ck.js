function makeHeader(e){return'Content-Disposition: form-data; name="upload"; filename="'+e+'"'}var common=require("../common"),test=require("utest"),assert=common.assert,IncomingForm=common.require("incoming_form").IncomingForm,path=require("path"),form;test("IncomingForm",{before:function(){form=new IncomingForm},"#_fileName with regular characters":function(){var e="foo.txt";assert.equal(form._fileName(makeHeader(e)),"foo.txt")},"#_fileName with unescaped quote":function(){var e='my".txt';assert.equal(form._fileName(makeHeader(e)),'my".txt')},"#_fileName with escaped quote":function(){var e="my%22.txt";assert.equal(form._fileName(makeHeader(e)),'my".txt')},"#_fileName with bad quote and additional sub-header":function(){var e='my".txt',t=makeHeader(e)+'; foo="bar"';assert.equal(form._fileName(t),e)},"#_fileName with semicolon":function(){var e="my;.txt";assert.equal(form._fileName(makeHeader(e)),"my;.txt")},"#_fileName with utf8 character":function(){var e="my&#9731;.txt";assert.equal(form._fileName(makeHeader(e)),"myâ˜ƒ.txt")},"#_uploadPath strips harmful characters from extension when keepExtensions":function(){form.keepExtensions=!0;var e=path.extname(form._uploadPath("fine.jpg?foo=bar"));assert.equal(e,".jpg");var e=path.extname(form._uploadPath("fine?foo=bar"));assert.equal(e,"");var e=path.extname(form._uploadPath("super.cr2+dsad"));assert.equal(e,".cr2");var e=path.extname(form._uploadPath("super.bar"));assert.equal(e,".bar")}});