require("../test/common");var http=require("http"),util=require("util"),formidable=require("formidable"),server;server=http.createServer(function(e,t){if(e.url=="/"){t.writeHead(200,{"content-type":"text/html"});t.end('<form action="/upload" enctype="multipart/form-data" method="post"><input type="text" name="title"><br><input type="file" name="upload" multiple="multiple"><br><input type="submit" value="Upload"></form>')}else if(e.url=="/upload"){var n=new formidable.IncomingForm,r=[],i=[];n.uploadDir=TEST_TMP;n.on("field",function(e,t){console.log(e,t);i.push([e,t])}).on("file",function(e,t){console.log(e,t);r.push([e,t])}).on("end",function(){console.log("-> upload done");t.writeHead(200,{"content-type":"text/plain"});t.write("received fields:\n\n "+util.inspect(i));t.write("\n\n");t.end("received files:\n\n "+util.inspect(r))});n.parse(e)}else{t.writeHead(404,{"content-type":"text/plain"});t.end("404")}});server.listen(TEST_PORT);console.log("listening on http://localhost:"+TEST_PORT+"/");