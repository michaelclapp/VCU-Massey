function File(e){EventEmitter.call(this);this.size=0;this.path=null;this.name=null;this.type=null;this.hash=null;this.lastModifiedDate=null;this._writeStream=null;for(var t in e)this[t]=e[t];typeof this.hash=="string"?this.hash=crypto.createHash(e.hash):this.hash=null}global.GENTLY&&(require=GENTLY.hijack(require));var util=require("util"),WriteStream=require("fs").WriteStream,EventEmitter=require("events").EventEmitter,crypto=require("crypto");module.exports=File;util.inherits(File,EventEmitter);File.prototype.open=function(){this._writeStream=new WriteStream(this.path)};File.prototype.toJSON=function(){return{size:this.size,path:this.path,name:this.name,type:this.type,mtime:this.lastModifiedDate,length:this.length,filename:this.filename,mime:this.mime}};File.prototype.write=function(e,t){var n=this;n.hash&&n.hash.update(e);this._writeStream.write(e,function(){n.lastModifiedDate=new Date;n.size+=e.length;n.emit("progress",n.size);t()})};File.prototype.end=function(e){var t=this;t.hash&&(t.hash=t.hash.digest("hex"));this._writeStream.end(function(){t.emit("end");e()})};