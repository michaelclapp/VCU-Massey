/**
 * Module dependencies.
 */function Agent(){if(!(this instanceof Agent))return new Agent;this.jar=new CookieJar}var CookieJar=require("cookiejar").CookieJar,CookieAccess=require("cookiejar").CookieAccessInfo,parse=require("url").parse,request=require("./index"),methods=require("methods");module.exports=Agent;Agent.prototype.saveCookies=function(e){var t=e.headers["set-cookie"];t&&this.jar.setCookies(t)};Agent.prototype.attachCookies=function(e){var t=parse(e.url),n=CookieAccess(t.host,t.pathname,"https:"==t.protocol),r=this.jar.getCookies(n).toValueString();e.cookies=r};methods.forEach(function(e){var t="delete"==e?"del":e;e=e.toUpperCase();Agent.prototype[t]=function(t,n){var r=request(e,t);r.on("response",this.saveCookies.bind(this));r.on("redirect",this.saveCookies.bind(this));r.on("redirect",this.attachCookies.bind(this,r));this.attachCookies(r);n&&r.end(n);return r}});