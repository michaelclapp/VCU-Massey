var request=require("../index"),http=require("http"),requests=0,assert=require("assert"),server=http.createServer(function(e,t){console.error(e.method,e.url);requests++;if(e.method==="POST"){console.error("send 303");t.setHeader("location",e.url);t.statusCode=303;t.end("try again, i guess\n")}else{console.error("send 200");t.end("ok: "+requests)}});server.listen(6767);request.post({url:"http://localhost:6767/foo",followAllRedirects:!0,form:{foo:"bar"}},function(e,t,n){if(e)throw e;assert.equal(n,"ok: 2");assert.equal(requests,2);console.error("ok - "+process.version);server.close()});