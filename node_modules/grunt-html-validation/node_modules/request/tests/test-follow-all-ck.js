var request=require("../index"),http=require("http"),requests=0,assert=require("assert"),server=http.createServer(function(e,t){requests++;var n=e.headers.cookie;n?n=+n.split("=")[1]||0:n=0;if(n>3){t.end("ok: "+requests);return}t.setHeader("set-cookie","c="+(n+1));t.setHeader("location",e.url);t.statusCode=302;t.end("try again, i guess\n")});server.listen(6767);request.post({url:"http://localhost:6767/foo",followAllRedirects:!0,jar:!0,form:{foo:"bar"}},function(e,t,n){if(e)throw e;assert.equal(n,"ok: 5");assert.equal(requests,5);console.error("ok - "+process.version);server.close()});