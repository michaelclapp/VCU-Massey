// Load modules
var Http=require("http"),Request=require("request"),Hawk=require("../lib"),internals={credentials:{dh37fgj492je:{id:"dh37fgj492je",key:"werxhqb98rpaxn39848xrunpaw3489ruxnpa98w4rxn",algorithm:"sha256",user:"Steve"}}},credentialsFunc=function(e,t){return t(null,internals.credentials[e])},handler=function(e,t){Hawk.server.authenticate(e,credentialsFunc,{},function(e,n,r){var i=e?"Shoosh!":"Hello "+n.user+" "+r.ext,s={"Content-Type":"text/plain","Server-Authorization":Hawk.server.header(n,r,{payload:i,contentType:"text/plain"})};t.writeHead(e?401:200,s);t.end(i)})};Http.createServer(handler).listen(8e3,"127.0.0.1");Request("http://127.0.0.1:8000/resource/1?b=1&a=2",function(e,t,n){console.log(t.statusCode+": "+n)});credentialsFunc("dh37fgj492je",function(e,t){var n=Hawk.client.header("http://127.0.0.1:8000/resource/1?b=1&a=2","GET",{credentials:t,ext:"and welcome!"}),r={uri:"http://127.0.0.1:8000/resource/1?b=1&a=2",method:"GET",headers:{authorization:n.field}};Request(r,function(e,r,i){var s=Hawk.client.authenticate(r,t,n.artifacts,{payload:i});console.log(r.statusCode+": "+i+(s?" (valid)":" (invalid)"));process.exit(0)})});