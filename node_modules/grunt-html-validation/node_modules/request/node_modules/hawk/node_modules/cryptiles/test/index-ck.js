// Load modules
var Lab=require("lab"),Cryptiles=require("../lib"),internals={},expect=Lab.expect,before=Lab.before,after=Lab.after,describe=Lab.experiment,it=Lab.test;describe("Cryptiles",function(){describe("#randomString",function(){it("should generate the right length string",function(e){for(var t=1;t<=1e3;++t)expect(Cryptiles.randomString(t).length).to.equal(t);e()});it("returns an error on invalid bits size",function(e){expect(Cryptiles.randomString(1e20).message).to.equal("Failed generating random bits: Argument #1 must be number > 0");e()})});describe("#randomBits",function(){it("returns an error on invalid input",function(e){expect(Cryptiles.randomBits(0).message).to.equal("Invalid random bits count");e()})});describe("#fixedTimeComparison",function(){var e=Cryptiles.randomString(5e4),t=Cryptiles.randomString(15e4);it("should take the same amount of time comparing different string sizes",function(n){var r=Date.now();Cryptiles.fixedTimeComparison(t,e);var i=Date.now()-r;r=Date.now();Cryptiles.fixedTimeComparison(t,t);var s=Date.now()-r;expect(s-i).to.be.within(-20,20);n()});it("should return true for equal strings",function(t){expect(Cryptiles.fixedTimeComparison(e,e)).to.equal(!0);t()});it("should return false for different strings (size, a < b)",function(t){expect(Cryptiles.fixedTimeComparison(e,e+"x")).to.equal(!1);t()});it("should return false for different strings (size, a > b)",function(t){expect(Cryptiles.fixedTimeComparison(e+"x",e)).to.equal(!1);t()});it("should return false for different strings (size, a = b)",function(t){expect(Cryptiles.fixedTimeComparison(e+"x",e+"y")).to.equal(!1);t()});it("should return false when not a string",function(e){expect(Cryptiles.fixedTimeComparison("x",null)).to.equal(!1);e()})})});