var common=require("../common"),assert=common.assert,CombinedStream=common.CombinedStream,fs=require("fs"),FILE1=common.dir.fixture+"/file1.txt",BUFFER=new Buffer("Bacon is delicious"),FILE2=common.dir.fixture+"/file2.txt",STRING="The â‚¬ kicks the $'s ass!",EXPECTED=fs.readFileSync(FILE1)+BUFFER+fs.readFileSync(FILE2)+STRING,GOT;(function(){var t=CombinedStream.create();t.append(fs.createReadStream(FILE1));t.append(BUFFER);t.append(fs.createReadStream(FILE2));t.append(function(e){e(STRING)});var n=common.dir.tmp+"/combined-file1-buffer-file2-string.txt",r=fs.createWriteStream(n);t.pipe(r);r.on("close",function(){GOT=fs.readFileSync(n,"utf8")})})();process.on("exit",function(){assert.strictEqual(GOT,EXPECTED)});