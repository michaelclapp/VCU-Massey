function safeStringify(e){var t;try{t=JSON.stringify(e)}catch(n){t=_safeStringify(e)}return t}function isReadStream(e){if(e.readable&&e.path&&e.mode)return!0}function toBase64(e){return(new Buffer(e||"","ascii")).toString("base64")}function md5(e){return crypto.createHash("md5").update(e).digest("hex")}function Request(e){stream.Stream.call(this);this.readable=!0;this.writable=!0;typeof e=="string"&&(e={uri:e});var t=Object.keys(Request.prototype);for(var n in e)t.indexOf(n)===-1?this[n]=e[n]:typeof e[n]=="function"&&delete e[n];e.method&&(this.explicitMethod=!0);this.init(e)}function toJSON(){return getSafe(this,"__"+((1+Math.random())*65536|0).toString(16))}var http=require("http"),https=!1,tls=!1,url=require("url"),util=require("util"),stream=require("stream"),qs=require("qs"),querystring=require("querystring"),crypto=require("crypto"),oauth=require("oauth-sign"),hawk=require("hawk"),aws=require("aws-sign"),httpSignature=require("http-signature"),uuid=require("node-uuid"),mime=require("mime"),tunnel=require("tunnel-agent"),_safeStringify=require("json-stringify-safe"),ForeverAgent=require("forever-agent"),FormData=require("form-data"),Cookie=require("cookie-jar"),CookieJar=Cookie.Jar,cookieJar=new CookieJar,copy=require("./lib/copy"),debug=require("./lib/debug"),getSafe=require("./lib/getSafe"),globalPool={},isUrl=/^https?:/i;try{https=require("https")}catch(e){}try{tls=require("tls")}catch(e){}if(https&&!https.Agent){https.Agent=function(e){http.Agent.call(this,e)};util.inherits(https.Agent,http.Agent);https.Agent.prototype._getConnection=function(e,t,n){var r=tls.connect(t,e,this.options,function(){n&&n()});return r}}util.inherits(Request,stream.Stream);Request.prototype.init=function(e){var t=this;e||(e={});t.method||(t.method=e.method||"GET");t.localAddress=e.localAddress;debug(e);!t.pool&&t.pool!==!1&&(t.pool=globalPool);t.dests=t.dests||[];t.__isRequestRequest=!0;if(!t._callback&&t.callback){t._callback=t.callback;t.callback=function(){if(t._callbackCalled)return;t._callbackCalled=!0;t._callback.apply(t,arguments)};t.on("error",t.callback.bind());t.on("complete",t.callback.bind(t,null))}if(t.url&&!t.uri){t.uri=t.url;delete t.url}if(!t.uri)return t.emit("error",new Error("options.uri is a required argument"));typeof t.uri=="string"&&(t.uri=url.parse(t.uri));t.strictSSL===!1&&(t.rejectUnauthorized=!1);if(t.proxy){typeof t.proxy=="string"&&(t.proxy=url.parse(t.proxy));if(http.globalAgent&&t.uri.protocol==="https:"){var n=t.proxy.protocol==="http:"?tunnel.httpsOverHttp:tunnel.httpsOverHttps,r={proxy:{host:t.proxy.hostname,port:+t.proxy.port,proxyAuth:t.proxy.auth,headers:{Host:t.uri.hostname+":"+(t.uri.port||t.uri.protocol==="https:"?443:80)}},rejectUnauthorized:t.rejectUnauthorized,ca:this.ca};t.agent=n(r);t.tunnel=!0}}t.uri.pathname||(t.uri.pathname="/");if(!t.uri.host){var i=url.format(t.uri),s='Invalid URI "'+i+'"';Object.keys(e).length===0&&(s+=". This can be caused by a crappy redirection.");t.emit("error",new Error(s));return}t._redirectsFollowed=t._redirectsFollowed||0;t.maxRedirects=t.maxRedirects!==undefined?t.maxRedirects:10;t.followRedirect=t.followRedirect!==undefined?t.followRedirect:!0;t.followAllRedirects=t.followAllRedirects!==undefined?t.followAllRedirects:!1;if(t.followRedirect||t.followAllRedirects)t.redirects=t.redirects||[];t.headers=t.headers?copy(t.headers):{};t.setHost=!1;if(!t.hasHeader("host")){t.setHeader("host",t.uri.hostname);t.uri.port&&(t.uri.port!==80||t.uri.protocol!=="http:")&&(t.uri.port!==443||t.uri.protocol!=="https:")&&t.setHeader("host",t.getHeader("host")+(":"+t.uri.port));t.setHost=!0}t.jar(t._jar||e.jar);t.uri.port||(t.uri.protocol=="http:"?t.uri.port=80:t.uri.protocol=="https:"&&(t.uri.port=443));if(t.proxy&&!t.tunnel){t.port=t.proxy.port;t.host=t.proxy.hostname}else{t.port=t.uri.port;t.host=t.uri.hostname}t.clientErrorHandler=function(e){if(t._aborted)return;if(t.req&&t.req._reusedSocket&&e.code==="ECONNRESET"&&t.agent.addRequestNoreuse){t.agent={addRequest:t.agent.addRequestNoreuse.bind(t.agent)};t.start();t.req.end();return}if(t.timeout&&t.timeoutTimer){clearTimeout(t.timeoutTimer);t.timeoutTimer=null}t.emit("error",e)};t._parserErrorHandler=function(e){this.res?this.res.request?this.res.request.emit("error",e):this.res.emit("error",e):this._httpMessage.emit("error",e)};e.form&&t.form(e.form);e.qs&&t.qs(e.qs);t.uri.path?t.path=t.uri.path:t.path=t.uri.pathname+(t.uri.search||"");t.path.length===0&&(t.path="/");e.oauth&&t.oauth(e.oauth);e.aws&&t.aws(e.aws);e.hawk&&t.hawk(e.hawk);e.httpSignature&&t.httpSignature(e.httpSignature);e.auth&&t.auth(e.auth.user===""?e.auth.user:e.auth.user||e.auth.username,e.auth.pass||e.auth.password,e.auth.sendImmediately);if(t.uri.auth&&!t.hasHeader("authorization")){var o=t.uri.auth.split(":").map(function(e){return querystring.unescape(e)});t.auth(o[0],o.slice(1).join(":"),!0)}t.proxy&&t.proxy.auth&&!t.hasHeader("proxy-authorization")&&!t.tunnel&&t.setHeader("proxy-authorization","Basic "+toBase64(t.proxy.auth.split(":").map(function(e){return querystring.unescape(e)}).join(":")));t.proxy&&!t.tunnel&&(t.path=t.uri.protocol+"//"+t.uri.host+t.path);if(e.json)t.json(e.json);else if(e.multipart){t.boundary=uuid();t.multipart(e.multipart)}if(t.body){var u=0;if(!Buffer.isBuffer(t.body))if(Array.isArray(t.body))for(var a=0;a<t.body.length;a++)u+=t.body[a].length;else{t.body=new Buffer(t.body);u=t.body.length}else u=t.body.length;if(!u)throw new Error("Argument error, options.body.");t.hasHeader("content-length")||t.setHeader("content-length",u)}var f=t.proxy&&!t.tunnel?t.proxy.protocol:t.uri.protocol,l={"http:":http,"https:":https},c=t.httpModules||{};t.httpModule=c[f]||l[f];if(!t.httpModule)return this.emit("error",new Error("Invalid protocol"));e.ca&&(t.ca=e.ca);if(!t.agent){e.agentOptions&&(t.agentOptions=e.agentOptions);e.agentClass?t.agentClass=e.agentClass:e.forever?t.agentClass=f==="http:"?ForeverAgent:ForeverAgent.SSL:t.agentClass=t.httpModule.Agent}if(t.pool===!1)t.agent=!1;else{t.agent=t.agent||t.getAgent();t.maxSockets&&(t.agent.maxSockets=t.maxSockets);t.pool.maxSockets&&(t.agent.maxSockets=t.pool.maxSockets)}t.on("pipe",function(e){if(t.ntick&&t._started)throw new Error("You cannot pipe to this stream after the outbound request has started.");t.src=e;if(isReadStream(e))t.hasHeader("content-type")||t.setHeader("content-type",mime.lookup(e.path));else{if(e.headers)for(var n in e.headers)t.hasHeader(n)||t.setHeader(n,e.headers[n]);t._json&&!t.hasHeader("content-type")&&t.setHeader("content-type","application/json");e.method&&!t.explicitMethod&&(t.method=e.method)}});process.nextTick(function(){if(t._aborted)return;if(t._form){t.setHeaders(t._form.getHeaders());t._form.pipe(t)}if(t.body){Array.isArray(t.body)?t.body.forEach(function(e){t.write(e)}):t.write(t.body);t.end()}else if(t.requestBodyStream){console.warn("options.requestBodyStream is deprecated, please pass the request object to stream.pipe.");t.requestBodyStream.pipe(t)}else if(!t.src){t.method!=="GET"&&typeof t.method!="undefined"&&t.setHeader("content-length",0);t.end()}t.ntick=!0})};Request.prototype._updateProtocol=function(){var e=this,t=e.uri.protocol;if(t==="https:"){if(e.proxy){e.tunnel=!0;var n=e.proxy.protocol==="http:"?tunnel.httpsOverHttp:tunnel.httpsOverHttps,r={proxy:{host:e.proxy.hostname,port:+e.proxy.port,proxyAuth:e.proxy.auth},rejectUnauthorized:e.rejectUnauthorized,ca:e.ca};e.agent=n(r);return}e.httpModule=https;switch(e.agentClass){case ForeverAgent:e.agentClass=ForeverAgent.SSL;break;case http.Agent:e.agentClass=https.Agent;break;default:return}e.agent&&(e.agent=e.getAgent())}else{e.tunnel&&(e.tunnel=!1);e.httpModule=http;switch(e.agentClass){case ForeverAgent.SSL:e.agentClass=ForeverAgent;break;case https.Agent:e.agentClass=http.Agent;break;default:return}if(e.agent){e.agent=null;e.agent=e.getAgent()}}};Request.prototype.getAgent=function(){var e=this.agentClass,t={};if(this.agentOptions)for(var n in this.agentOptions)t[n]=this.agentOptions[n];this.ca&&(t.ca=this.ca);typeof this.rejectUnauthorized!="undefined"&&(t.rejectUnauthorized=this.rejectUnauthorized);if(this.cert&&this.key){t.key=this.key;t.cert=this.cert}var r="";e!==this.httpModule.Agent&&(r+=e.name);if(!this.httpModule.globalAgent){t.host=this.host;t.port=this.port;r&&(r+=":");r+=this.host+":"+this.port}var i=this.proxy;typeof i=="string"&&(i=url.parse(i));var s=i&&i.protocol==="https:"||this.uri.protocol==="https:";if(s){if(t.ca){r&&(r+=":");r+=t.ca}if(typeof t.rejectUnauthorized!="undefined"){r&&(r+=":");r+=t.rejectUnauthorized}t.cert&&(r+=t.cert.toString("ascii")+t.key.toString("ascii"));if(t.ciphers){r&&(r+=":");r+=t.ciphers}if(t.secureOptions){r&&(r+=":");r+=t.secureOptions}}if(this.pool===globalPool&&!r&&Object.keys(t).length===0&&this.httpModule.globalAgent)return this.httpModule.globalAgent;r=this.uri.protocol+r;return this.pool[r]?this.pool[r]:this.pool[r]=new e(t)};Request.prototype.start=function(){var e=this;if(e._aborted)return;e._started=!0;e.method=e.method||"GET";e.href=e.uri.href;e.src&&e.src.stat&&e.src.stat.size&&!e.hasHeader("content-length")&&e.setHeader("content-length",e.src.stat.size);e._aws&&e.aws(e._aws,!0);var t=copy(e);delete t.auth;debug("make request",e.uri.href);e.req=e.httpModule.request(t,e.onResponse.bind(e));if(e.timeout&&!e.timeoutTimer){e.timeoutTimer=setTimeout(function(){e.req.abort();var t=new Error("ETIMEDOUT");t.code="ETIMEDOUT";e.emit("error",t)},e.timeout);e.req.setTimeout&&e.req.setTimeout(e.timeout,function(){if(e.req){e.req.abort();var t=new Error("ESOCKETTIMEDOUT");t.code="ESOCKETTIMEDOUT";e.emit("error",t)}})}e.req.on("error",e.clientErrorHandler);e.req.on("drain",function(){e.emit("drain")});e.on("end",function(){e.req.connection&&e.req.connection.removeListener("error",e._parserErrorHandler)});e.emit("request",e.req)};Request.prototype.onResponse=function(e){var t=this;debug("onResponse",t.uri.href,e.statusCode,e.headers);e.on("end",function(){debug("response end",t.uri.href,e.statusCode,e.headers)});e.connection.listeners("error").indexOf(t._parserErrorHandler)===-1&&e.connection.once("error",t._parserErrorHandler);if(t._aborted){debug("aborted",t.uri.href);e.resume();return}t._paused?e.pause():e.resume();t.response=e;e.request=t;e.toJSON=toJSON;if(t.httpModule===https&&t.strictSSL&&!e.client.authorized){debug("strict ssl error",t.uri.href);var n=e.client.authorizationError;t.emit("error",new Error("SSL Error: "+n));return}t.setHost&&t.hasHeader("host")&&delete t.headers[t.hasHeader("host")];if(t.timeout&&t.timeoutTimer){clearTimeout(t.timeoutTimer);t.timeoutTimer=null}var r=function(e){t._jar&&(t._jar.add?t._jar.add(new Cookie(e)):cookieJar.add(new Cookie(e)))};if(hasHeader("set-cookie",e.headers)&&!t._disableCookies){var i=hasHeader("set-cookie",e.headers);Array.isArray(e.headers[i])?e.headers[i].forEach(r):r(e.headers[i])}var s=null;if(e.statusCode>=300&&e.statusCode<400&&hasHeader("location",e.headers)){var o=e.headers[hasHeader("location",e.headers)];debug("redirect",o);if(t.followAllRedirects)s=o;else if(t.followRedirect)switch(t.method){case"PATCH":case"PUT":case"POST":case"DELETE":break;default:s=o}}else if(e.statusCode==401&&t._hasAuth&&!t._sentAuth){var u=e.headers[hasHeader("www-authenticate",e.headers)],a=u&&u.split(" ")[0];debug("reauth",a);switch(a){case"Basic":t.auth(t._user,t._pass,!0);s=t.uri;break;case"Digest":var f=u.match(/([a-z0-9_-]+)="([^"]+)"/gi),l={};for(var c=0;c<f.length;c++){var h=f[c].indexOf("="),p=f[c].substring(0,h),d=f[c].substring(h+1);l[p]=d.substring(1,d.length-1)}var v=md5(t._user+":"+l.realm+":"+t._pass),m=md5(t.method+":"+t.uri.path),g=md5(v+":"+l.nonce+":1::auth:"+m),y={username:t._user,realm:l.realm,nonce:l.nonce,uri:t.uri.path,qop:l.qop,response:g,nc:1,cnonce:""};u=[];for(var b in y)u.push(b+'="'+y[b]+'"');u="Digest "+u.join(", ");t.setHeader("authorization",u);t._sentAuth=!0;s=t.uri}}if(s){debug("redirect to",s);t._paused&&e.resume();if(t._redirectsFollowed>=t.maxRedirects){t.emit("error",new Error("Exceeded maxRedirects. Probably stuck in a redirect loop "+t.uri.href));return}t._redirectsFollowed+=1;isUrl.test(s)||(s=url.resolve(t.uri.href,s));var w=t.uri;t.uri=url.parse(s);t.uri.protocol!==w.protocol&&t._updateProtocol();t.redirects.push({statusCode:e.statusCode,redirectUri:s});t.followAllRedirects&&e.statusCode!=401&&(t.method="GET");delete t.src;delete t.req;delete t.agent;delete t._started;if(e.statusCode!=401){delete t.body;delete t._form;if(t.headers){t.hasHeader("host")&&delete t.headers[t.hasHeader("host")];t.hasHeader("content-type")&&delete t.headers[t.hasHeader("content-type")];t.hasHeader("content-length")&&delete t.headers[t.hasHeader("content-length")]}}t.emit("redirect");t.init();return}t._redirectsFollowed=t._redirectsFollowed||0;e.on("close",function(){t._ended||t.response.emit("end")});t.encoding&&(t.dests.length!==0?console.error("Ignoring encoding parameter as this stream is being piped to another stream which makes the encoding option invalid."):e.setEncoding(t.encoding));t.emit("response",e);t.dests.forEach(function(e){t.pipeDest(e)});e.on("data",function(e){t._destdata=!0;t.emit("data",e)});e.on("end",function(e){t._ended=!0;t.emit("end",e)});e.on("close",function(){t.emit("close")});if(t.callback){var E=[],S=0;t.on("data",function(e){E.push(e);S+=e.length});t.on("end",function(){debug("end event",t.uri.href);if(t._aborted){debug("aborted",t.uri.href);return}if(E.length&&Buffer.isBuffer(E[0])){debug("has body",t.uri.href,S);var n=new Buffer(S),r=0;E.forEach(function(e){e.copy(n,r,0,e.length);r+=e.length});t.encoding===null?e.body=n:e.body=n.toString(t.encoding)}else if(E.length){t.encoding==="utf8"&&E[0].length>0&&E[0][0]==="ï»¿"&&(E[0]=E[0].substring(1));e.body=E.join("")}if(t._json)try{e.body=JSON.parse(e.body)}catch(i){}debug("emitting complete",t.uri.href);e.body==undefined&&!t._json&&(e.body="");t.emit("complete",e,e.body)})}else t.on("end",function(){if(t._aborted){debug("aborted",t.uri.href);return}t.emit("complete",e)});debug("finish init function",t.uri.href)};Request.prototype.abort=function(){this._aborted=!0;this.req?this.req.abort():this.response&&this.response.abort();this.emit("abort")};Request.prototype.pipeDest=function(e){var t=this.response;if(e.headers&&!e.headersSent){if(hasHeader("content-type",t.headers)){var n=hasHeader("content-type",t.headers);e.setHeader?e.setHeader(n,t.headers[n]):e.headers[n]=t.headers[n]}if(hasHeader("content-length",t.headers)){var r=hasHeader("content-length",t.headers);e.setHeader?e.setHeader(r,t.headers[r]):e.headers[r]=t.headers[r]}}if(e.setHeader&&!e.headersSent){for(var i in t.headers)e.setHeader(i,t.headers[i]);e.statusCode=t.statusCode}this.pipefilter&&this.pipefilter(t,e)};Request.prototype.setHeader=function(e,t,n){n===undefined&&(n=!0);n||!this.hasHeader(e)?this.headers[e]=t:this.headers[this.hasHeader(e)]+=","+t;return this};Request.prototype.setHeaders=function(e){for(var t in e)this.setHeader(t,e[t]);return this};Request.prototype.hasHeader=function(e,t){var t=Object.keys(t||this.headers),n=t.map(function(e){return e.toLowerCase()});e=e.toLowerCase();for(var r=0;r<n.length;r++)if(n[r]===e)return t[r];return!1};var hasHeader=Request.prototype.hasHeader;Request.prototype.qs=function(e,t){var n;!t&&this.uri.query?n=qs.parse(this.uri.query):n={};for(var r in e)n[r]=e[r];if(qs.stringify(n)==="")return this;this.uri=url.parse(this.uri.href.split("?")[0]+"?"+qs.stringify(n));this.url=this.uri;this.path=this.uri.path;return this};Request.prototype.form=function(e){if(e){this.setHeader("content-type","application/x-www-form-urlencoded; charset=utf-8");this.body=qs.stringify(e).toString("utf8");return this}this._form=new FormData;return this._form};Request.prototype.multipart=function(e){var t=this;t.body=[];t.hasHeader("content-type")?t.setHeader("content-type",t.headers["content-type"].split(";")[0]+"; boundary="+t.boundary):t.setHeader("content-type","multipart/related; boundary="+t.boundary);if(!e.forEach)throw new Error("Argument error, options.multipart.");t.preambleCRLF&&t.body.push(new Buffer("\r\n"));e.forEach(function(e){var n=e.body;if(n==null)throw Error("Body attribute missing in multipart.");delete e.body;var r="--"+t.boundary+"\r\n";Object.keys(e).forEach(function(t){r+=t+": "+e[t]+"\r\n"});r+="\r\n";t.body.push(new Buffer(r));t.body.push(new Buffer(n));t.body.push(new Buffer("\r\n"))});t.body.push(new Buffer("--"+t.boundary+"--"));return t};Request.prototype.json=function(e){var t=this;t.hasHeader("accept")||t.setHeader("accept","application/json");this._json=!0;if(typeof e=="boolean"){if(typeof this.body=="object"){this.body=safeStringify(this.body);t.setHeader("content-type","application/json")}}else{this.body=safeStringify(e);t.setHeader("content-type","application/json")}return this};Request.prototype.getHeader=function(e,t){var n,r,i;t||(t=this.headers);Object.keys(t).forEach(function(s){r=new RegExp(e,"i");i=s.match(r);i&&(n=t[s])});return n};var getHeader=Request.prototype.getHeader;Request.prototype.auth=function(e,t,n){if(typeof e!="string"||t!==undefined&&typeof t!="string")throw new Error("auth() received invalid user or password");this._user=e;this._pass=t;this._hasAuth=!0;var r=typeof t!="undefined"?e+":"+t:e;if(n||typeof n=="undefined"){this.setHeader("authorization","Basic "+toBase64(r));this._sentAuth=!0}return this};Request.prototype.aws=function(e,t){if(!t){this._aws=e;return this}var n=new Date;this.setHeader("date",n.toUTCString());var r={key:e.key,secret:e.secret,verb:this.method.toUpperCase(),date:n,contentType:this.getHeader("content-type")||"",md5:this.getHeader("content-md5")||"",amazonHeaders:aws.canonicalizeHeaders(this.headers)};e.bucket&&this.path?r.resource="/"+e.bucket+this.path:e.bucket&&!this.path?r.resource="/"+e.bucket:!e.bucket&&this.path?r.resource=this.path:!e.bucket&&!this.path&&(r.resource="/");r.resource=aws.canonicalizeResource(r.resource);this.setHeader("authorization",aws.authorization(r));return this};Request.prototype.httpSignature=function(e){var t=this;httpSignature.signRequest({getHeader:function(e){return getHeader(e,t.headers)},setHeader:function(e,n){t.setHeader(e,n)},method:this.method,path:this.path},e);debug("httpSignature authorization",this.getHeader("authorization"));return this};Request.prototype.hawk=function(e){this.setHeader("Authorization",hawk.client.header(this.uri,this.method,e).field)};Request.prototype.oauth=function(e){var t;this.hasHeader("content-type")&&this.getHeader("content-type").slice(0,"application/x-www-form-urlencoded".length)==="application/x-www-form-urlencoded"&&(t=qs.parse(this.body));this.uri.query&&(t=qs.parse(this.uri.query));t||(t={});var n={};for(var r in t)n[r]=t[r];for(var r in e)n["oauth_"+r]=e[r];n.oauth_version||(n.oauth_version="1.0");n.oauth_timestamp||(n.oauth_timestamp=Math.floor(Date.now()/1e3).toString());n.oauth_nonce||(n.oauth_nonce=uuid().replace(/-/g,""));n.oauth_signature_method="HMAC-SHA1";var i=n.oauth_consumer_secret;delete n.oauth_consumer_secret;var s=n.oauth_token_secret;delete n.oauth_token_secret;var o=n.oauth_timestamp,u=this.uri.protocol+"//"+this.uri.host+this.uri.pathname,a=oauth.hmacsign(this.method,u,n,i,s);for(var r in t)if(!(r.slice(0,"oauth_")in e)){delete n["oauth_"+r];r!=="x_auth_mode"&&delete n[r]}n.oauth_timestamp=o;var f="OAuth "+Object.keys(n).sort().map(function(e){return e+'="'+oauth.rfc3986(n[e])+'"'}).join(",");f+=',oauth_signature="'+oauth.rfc3986(a)+'"';this.setHeader("Authorization",f);return this};Request.prototype.jar=function(e){var t;this._redirectsFollowed===0&&(this.originalCookieHeader=this.getHeader("cookie"));if(!e){t=!1;this._disableCookies=!0}else e&&e.get?t=e.get({url:this.uri.href}):t=cookieJar.get({url:this.uri.href});if(t&&t.length){var n=t.map(function(e){return e.name+"="+e.value}).join("; ");this.originalCookieHeader?this.setHeader("cookie",this.originalCookieHeader+"; "+n):this.setHeader("cookie",n)}this._jar=e;return this};Request.prototype.pipe=function(e,t){if(this.response){if(this._destdata)throw new Error("You cannot pipe after data has been emitted from the response.");if(this._ended)throw new Error("You cannot pipe after the response has been ended.");stream.Stream.prototype.pipe.call(this,e,t);this.pipeDest(e);return e}this.dests.push(e);stream.Stream.prototype.pipe.call(this,e,t);return e};Request.prototype.write=function(){this._started||this.start();return this.req.write.apply(this.req,arguments)};Request.prototype.end=function(e){e&&this.write(e);this._started||this.start();this.req.end()};Request.prototype.pause=function(){this.response?this.response.pause.apply(this.response,arguments):this._paused=!0};Request.prototype.resume=function(){this.response?this.response.resume.apply(this.response,arguments):this._paused=!1};Request.prototype.destroy=function(){this._ended?this.response&&this.response.destroy():this.end()};Request.prototype.toJSON=toJSON;module.exports=Request;