// Copyright 2010-2012 Mikeal Rogers
//
//    Licensed under the Apache License, Version 2.0 (the "License");
//    you may not use this file except in compliance with the License.
//    You may obtain a copy of the License at
//
//        http://www.apache.org/licenses/LICENSE-2.0
//
//    Unless required by applicable law or agreed to in writing, software
//    distributed under the License is distributed on an "AS IS" BASIS,
//    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//    See the License for the specific language governing permissions and
//    limitations under the License.
function initParams(e,t,n){typeof t=="function"&&!n&&(n=t);if(t&&typeof t=="object")t.uri=e;else if(typeof e=="string")t={uri:e};else{t=e;e=t.uri}return{uri:e,options:t,callback:n}}function request(e,t,n){if(typeof e=="undefined")throw new Error("undefined is not a valid uri or options object.");typeof t=="function"&&!n&&(n=t);t&&typeof t=="object"?t.uri=e:typeof e=="string"?t={uri:e}:t=e;t=copy(t);n&&(t.callback=n);var r=new Request(t);return r}var Cookie=require("cookie-jar"),CookieJar=Cookie.Jar,cookieJar=new CookieJar,copy=require("./lib/copy"),Request=require("./request");module.exports=request;request.Request=Request;request.debug=process.env.NODE_DEBUG&&/request/.test(process.env.NODE_DEBUG);request.initParams=initParams;request.defaults=function(e,t){var n=function(n){var r=function(r,i,s){var o=initParams(r,i,s);for(var u in e)o.options[u]===undefined&&(o.options[u]=e[u]);typeof t=="function"&&(n===request?n=t:o.options._requester=t);return n(o.options,o.callback)};return r},r=n(request);r.get=n(request.get);r.patch=n(request.patch);r.post=n(request.post);r.put=n(request.put);r.head=n(request.head);r.del=n(request.del);r.cookie=n(request.cookie);r.jar=request.jar;return r};request.forever=function(e,t){var n={};if(t)for(option in t)n[option]=t[option];e&&(n.agentOptions=e);n.forever=!0;return request.defaults(n)};request.get=request;request.post=function(e,t,n){var r=initParams(e,t,n);r.options.method="POST";return request(r.uri||null,r.options,r.callback)};request.put=function(e,t,n){var r=initParams(e,t,n);r.options.method="PUT";return request(r.uri||null,r.options,r.callback)};request.patch=function(e,t,n){var r=initParams(e,t,n);r.options.method="PATCH";return request(r.uri||null,r.options,r.callback)};request.head=function(e,t,n){var r=initParams(e,t,n);r.options.method="HEAD";if(r.options.body||r.options.requestBodyStream||r.options.json&&typeof r.options.json!="boolean"||r.options.multipart)throw new Error("HTTP HEAD requests MUST NOT include a request body.");return request(r.uri||null,r.options,r.callback)};request.del=function(e,t,n){var r=initParams(e,t,n);r.options.method="DELETE";typeof r.options._requester=="function"&&(request=r.options._requester);return request(r.uri||null,r.options,r.callback)};request.jar=function(){return new CookieJar};request.cookie=function(e){e&&e.uri&&(e=e.uri);if(typeof e!="string")throw new Error("The cookie function only accepts STRING as param");return new Cookie(e)};