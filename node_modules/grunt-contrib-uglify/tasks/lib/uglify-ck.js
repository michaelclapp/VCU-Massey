/*
 * grunt-contrib-uglify
 * https://gruntjs.com/
 *
 * Copyright (c) 2013 "Cowboy" Ben Alman, contributors
 * Licensed under the MIT license.
 */"use strict";var UglifyJS=require("uglify-js"),fs=require("fs");exports.init=function(e){var t={};t.minify=function(t,r,i){i=i||{};e.verbose.write("Minifying with UglifyJS...");var s=null,o="",u=n(i,r),a=UglifyJS.OutputStream(u);t.forEach(function(t){var n=e.file.read(t);typeof i.sourceMapPrefix!="undefined"&&(t=t.replace(/^\/+/,"").split(/\/+/).slice(i.sourceMapPrefix).join("/"));o+=n;s=UglifyJS.parse(n,{filename:t,toplevel:s})});i.wrap&&(s=s.wrap_commonjs(i.wrap,i.exportAll));if(i.enclose){var f=e.util._.map(i.enclose,function(e,t){return t+":"+e});s=s.wrap_enclose(f)}s.figure_out_scope();if(i.compress!==!1){i.compress.warnings!==!0&&(i.compress.warnings=!1);var l=UglifyJS.Compressor(i.compress);s=s.transform(l);s.figure_out_scope()}i.mangle!==!1&&s.mangle_names(i.mangle);s.print(a);var c=a.get();if(i.sourceMappingURL||i.sourceMap)c+="\n//# sourceMappingURL="+(i.sourceMappingURL||i.sourceMap);var h={max:o,min:c,sourceMap:u.source_map};e.verbose.ok();return h};var n=function(t,n){var r={beautify:!1,source_map:null};t.preserveComments&&(t.preserveComments==="all"||t.preserveComments===!0?r.comments=!0:t.preserveComments==="some"?r.comments=/^!|@preserve|@license|@cc_on/i:e.util._.isFunction(t.preserveComments)&&(r.comments=t.preserveComments));t.banner&&t.sourceMap&&(r.preamble=t.banner);t.beautify&&(e.util._.isObject(t.beautify)?e.util._.extend(r,t.beautify):r.beautify=!0);if(t.sourceMap){var i;t.sourceMapIn&&(i=e.file.readJSON(t.sourceMapIn));r.source_map=UglifyJS.SourceMap({file:n,root:t.sourceMapRoot,orig:i})}return r};return t};