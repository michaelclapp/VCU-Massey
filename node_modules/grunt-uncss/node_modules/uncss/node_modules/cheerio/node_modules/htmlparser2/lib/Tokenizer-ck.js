function whitespace(e){return e===" "||e==="	"||e==="\r"||e==="\n"}function Tokenizer(e,t){this._state=TEXT;this._buffer="";this._sectionStart=0;this._index=0;this._options=e;this._special=0;this._cbs=t;this._running=!0}module.exports=Tokenizer;var i=0,TEXT=i++,BEFORE_TAG_NAME=i++,IN_TAG_NAME=i++,BEFORE_CLOSING_TAG_NAME=i++,IN_CLOSING_TAG_NAME=i++,AFTER_CLOSING_TAG_NAME=i++,BEFORE_ATTRIBUTE_NAME=i++,IN_ATTRIBUTE_NAME=i++,AFTER_ATTRIBUTE_NAME=i++,BEFORE_ATTRIBUTE_VALUE=i++,IN_ATTRIBUTE_VALUE_DOUBLE_QUOTES=i++,IN_ATTRIBUTE_VALUE_SINGLE_QUOTES=i++,IN_ATTRIBUTE_VALUE_NO_QUOTES=i++,BEFORE_DECLARATION=i++,IN_DECLARATION=i++,IN_PROCESSING_INSTRUCTION=i++,BEFORE_COMMENT=i++,IN_COMMENT=i++,AFTER_COMMENT_1=i++,AFTER_COMMENT_2=i++,BEFORE_CDATA_1=i++,BEFORE_CDATA_2=i++,BEFORE_CDATA_3=i++,BEFORE_CDATA_4=i++,BEFORE_CDATA_5=i++,BEFORE_CDATA_6=i++,IN_CDATA=i++,AFTER_CDATA_1=i++,AFTER_CDATA_2=i++,BEFORE_SPECIAL=i++,BEFORE_SPECIAL_END=i++,BEFORE_SCRIPT_1=i++,BEFORE_SCRIPT_2=i++,BEFORE_SCRIPT_3=i++,BEFORE_SCRIPT_4=i++,BEFORE_SCRIPT_5=i++,AFTER_SCRIPT_1=i++,AFTER_SCRIPT_2=i++,AFTER_SCRIPT_3=i++,AFTER_SCRIPT_4=i++,AFTER_SCRIPT_5=i++,BEFORE_STYLE_1=i++,BEFORE_STYLE_2=i++,BEFORE_STYLE_3=i++,BEFORE_STYLE_4=i++,AFTER_STYLE_1=i++,AFTER_STYLE_2=i++,AFTER_STYLE_3=i++,AFTER_STYLE_4=i++;Tokenizer.prototype.write=function(e){this._buffer+=e;while(this._index<this._buffer.length&&this._running){var t=this._buffer.charAt(this._index);if(this._state===TEXT){if(t==="<"){this._emitIfToken("ontext");this._state=BEFORE_TAG_NAME;this._sectionStart=this._index}}else if(this._state===BEFORE_TAG_NAME){if(t==="/")this._state=BEFORE_CLOSING_TAG_NAME;else if(t===">"||this._special>0)this._state=TEXT;else if(!whitespace(t))if(t==="!"){this._state=BEFORE_DECLARATION;this._sectionStart=this._index+1}else if(t==="?"){this._state=IN_PROCESSING_INSTRUCTION;this._sectionStart=this._index+1}else if(!!this._options&&!!this._options.xmlMode||t!=="s"&&t!=="S"){this._state=IN_TAG_NAME;this._sectionStart=this._index}else{this._state=BEFORE_SPECIAL;this._sectionStart=this._index}}else if(this._state===IN_TAG_NAME){if(t==="/"){this._emitToken("onopentagname");this._cbs.onselfclosingtag();this._state=AFTER_CLOSING_TAG_NAME}else if(t===">"){this._emitToken("onopentagname");this._cbs.onopentagend();this._state=TEXT;this._sectionStart=this._index+1}else if(whitespace(t)){this._emitToken("onopentagname");this._state=BEFORE_ATTRIBUTE_NAME}}else if(this._state===BEFORE_CLOSING_TAG_NAME){if(!whitespace(t))if(t===">")this._state=TEXT;else if(this._special>0){if(t!=="s"&&t!=="S"){this._state=TEXT;continue}this._state=BEFORE_SPECIAL_END}else{this._state=IN_CLOSING_TAG_NAME;this._sectionStart=this._index}}else if(this._state===IN_CLOSING_TAG_NAME){if(t===">"){this._emitToken("onclosetag");this._state=TEXT;this._sectionStart=this._index+1;this._special=0}else if(whitespace(t)){this._emitToken("onclosetag");this._state=AFTER_CLOSING_TAG_NAME;this._special=0}}else if(this._state===AFTER_CLOSING_TAG_NAME){if(t===">"){this._state=TEXT;this._sectionStart=this._index+1}}else if(this._state===BEFORE_ATTRIBUTE_NAME){if(t===">"){this._state=TEXT;this._cbs.onopentagend();this._sectionStart=this._index+1}else if(t==="/"){this._cbs.onselfclosingtag();this._state=AFTER_CLOSING_TAG_NAME}else if(!whitespace(t)){this._state=IN_ATTRIBUTE_NAME;this._sectionStart=this._index}}else if(this._state===IN_ATTRIBUTE_NAME){if(t==="="){this._emitIfToken("onattribname");this._state=BEFORE_ATTRIBUTE_VALUE}else if(whitespace(t)){this._emitIfToken("onattribname");this._state=AFTER_ATTRIBUTE_NAME}else if(t==="/"||t===">"){this._emitIfToken("onattribname");this._state=BEFORE_ATTRIBUTE_NAME;continue}}else if(this._state===AFTER_ATTRIBUTE_NAME)if(t==="=")this._state=BEFORE_ATTRIBUTE_VALUE;else{if(t==="/"||t===">"){this._state=BEFORE_ATTRIBUTE_NAME;continue}if(!whitespace(t)){this._state=IN_ATTRIBUTE_NAME;this._sectionStart=this._index}}else if(this._state===BEFORE_ATTRIBUTE_VALUE){if(t==='"'){this._state=IN_ATTRIBUTE_VALUE_DOUBLE_QUOTES;this._sectionStart=this._index+1}else if(t==="'"){this._state=IN_ATTRIBUTE_VALUE_SINGLE_QUOTES;this._sectionStart=this._index+1}else if(!whitespace(t)){this._state=IN_ATTRIBUTE_VALUE_NO_QUOTES;this._sectionStart=this._index}}else if(this._state===IN_ATTRIBUTE_VALUE_DOUBLE_QUOTES){if(t==='"'){this._emitToken("onattribvalue");this._state=BEFORE_ATTRIBUTE_NAME}}else if(this._state===IN_ATTRIBUTE_VALUE_SINGLE_QUOTES){if(t==="'"){this._state=BEFORE_ATTRIBUTE_NAME;this._emitToken("onattribvalue")}}else if(this._state===IN_ATTRIBUTE_VALUE_NO_QUOTES){if(t===">"){this._emitToken("onattribvalue");this._state=TEXT;this._cbs.onopentagend();this._sectionStart=this._index+1}else if(whitespace(t)){this._emitToken("onattribvalue");this._state=BEFORE_ATTRIBUTE_NAME}}else if(this._state===BEFORE_DECLARATION)t==="["?this._state=BEFORE_CDATA_1:t==="-"?this._state=BEFORE_COMMENT:this._state=IN_DECLARATION;else if(this._state===IN_DECLARATION){if(t===">"){this._emitToken("ondeclaration");this._state=TEXT;this._sectionStart=this._index+1}}else if(this._state===IN_PROCESSING_INSTRUCTION){if(t===">"){this._emitToken("onprocessinginstruction");this._state=TEXT;this._sectionStart=this._index+1}}else if(this._state===BEFORE_COMMENT)if(t==="-"){this._state=IN_COMMENT;this._sectionStart=this._index+1}else this._state=IN_DECLARATION;else if(this._state===IN_COMMENT)t==="-"&&(this._state=AFTER_COMMENT_1);else if(this._state===AFTER_COMMENT_1)t==="-"?this._state=AFTER_COMMENT_2:this._state=IN_COMMENT;else if(this._state===AFTER_COMMENT_2)if(t===">"){this._cbs.oncomment(this._buffer.substring(this._sectionStart,this._index-2));this._state=TEXT;this._sectionStart=this._index+1}else t!=="-"&&(this._state=IN_COMMENT);else if(this._state===BEFORE_CDATA_1)t==="C"?this._state=BEFORE_CDATA_2:this._state=IN_DECLARATION;else if(this._state===BEFORE_CDATA_2)t==="D"?this._state=BEFORE_CDATA_3:this._state=IN_DECLARATION;else if(this._state===BEFORE_CDATA_3)t==="A"?this._state=BEFORE_CDATA_4:this._state=IN_DECLARATION;else if(this._state===BEFORE_CDATA_4)t==="T"?this._state=BEFORE_CDATA_5:this._state=IN_DECLARATION;else if(this._state===BEFORE_CDATA_5)t==="A"?this._state=BEFORE_CDATA_6:this._state=IN_DECLARATION;else if(this._state===BEFORE_CDATA_6)if(t==="["){this._state=IN_CDATA;this._sectionStart=this._index+1}else this._state=IN_DECLARATION;else if(this._state===IN_CDATA)t==="]"&&(this._state=AFTER_CDATA_1);else if(this._state===AFTER_CDATA_1)t==="]"?this._state=AFTER_CDATA_2:this._state=IN_CDATA;else if(this._state===AFTER_CDATA_2)if(t===">"){this._cbs.oncdata(this._buffer.substring(this._sectionStart,this._index-2));this._state=TEXT;this._sectionStart=this._index+1}else t!=="]"&&(this._state=IN_CDATA);else if(this._state===BEFORE_SPECIAL)if(t==="c"||t==="C")this._state=BEFORE_SCRIPT_1;else{if(t!=="t"&&t!=="T"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_STYLE_1}else if(this._state===BEFORE_SPECIAL_END)this._special!==1||t!=="c"&&t!=="C"?this._special!==2||t!=="t"&&t!=="T"?this._state=TEXT:this._state=AFTER_STYLE_1:this._state=AFTER_SCRIPT_1;else if(this._state===BEFORE_SCRIPT_1){if(t!=="r"&&t!=="R"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_SCRIPT_2}else if(this._state===BEFORE_SCRIPT_2){if(t!=="i"&&t!=="I"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_SCRIPT_3}else if(this._state===BEFORE_SCRIPT_3){if(t!=="p"&&t!=="P"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_SCRIPT_4}else if(this._state===BEFORE_SCRIPT_4){if(t!=="t"&&t!=="T"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_SCRIPT_5}else{if(this._state===BEFORE_SCRIPT_5){if(t==="/"||t===">"||whitespace(t))this._special=1;this._state=IN_TAG_NAME;continue}if(this._state===AFTER_SCRIPT_1)t==="r"||t==="R"?this._state=AFTER_SCRIPT_2:this._state=TEXT;else if(this._state===AFTER_SCRIPT_2)t==="i"||t==="I"?this._state=AFTER_SCRIPT_3:this._state=TEXT;else if(this._state===AFTER_SCRIPT_3)t==="p"||t==="P"?this._state=AFTER_SCRIPT_4:this._state=TEXT;else if(this._state===AFTER_SCRIPT_4)t==="t"||t==="T"?this._state=AFTER_SCRIPT_5:this._state=TEXT;else if(this._state===AFTER_SCRIPT_5){if(t===">"||whitespace(t)){this._state=IN_CLOSING_TAG_NAME;this._sectionStart=this._index-6;continue}this._state=TEXT}else if(this._state===BEFORE_STYLE_1){if(t!=="y"&&t!=="Y"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_STYLE_2}else if(this._state===BEFORE_STYLE_2){if(t!=="l"&&t!=="L"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_STYLE_3}else if(this._state===BEFORE_STYLE_3){if(t!=="e"&&t!=="E"){this._state=IN_TAG_NAME;continue}this._state=BEFORE_STYLE_4}else{if(this._state===BEFORE_STYLE_4){if(t==="/"||t===">"||whitespace(t))this._special=2;this._state=IN_TAG_NAME;continue}if(this._state===AFTER_STYLE_1)t==="y"||t==="Y"?this._state=AFTER_STYLE_2:this._state=TEXT;else if(this._state===AFTER_STYLE_2)t==="l"||t==="L"?this._state=AFTER_STYLE_3:this._state=TEXT;else if(this._state===AFTER_STYLE_3)t==="e"||t==="E"?this._state=AFTER_STYLE_4:this._state=TEXT;else if(this._state===AFTER_STYLE_4){if(t===">"||whitespace(t)){this._state=IN_CLOSING_TAG_NAME;this._sectionStart=this._index-5;continue}this._state=TEXT}else this._cbs.onerror(Error("unknown state"),this._state)}}this._index++}if(this._sectionStart===-1){this._buffer="";this._index=0}else{if(this._state===TEXT){this._sectionStart!==this._index&&this._cbs.ontext(this._buffer.substr(this._sectionStart));this._buffer="";this._index=0}else if(this._sectionStart===this._index){this._buffer="";this._index=0}else if(this._sectionStart>0){this._buffer=this._buffer.substr(this._sectionStart);this._index-=this._sectionStart}this._sectionStart=0}};Tokenizer.prototype.pause=function(){this._running=!1};Tokenizer.prototype.resume=function(){this._running=!0};Tokenizer.prototype.end=function(e){e&&this.write(e);if(this._sectionStart>this._index){var t=this._buffer.substr(this._sectionStart);this._state===IN_CDATA||this._state===AFTER_CDATA_1||this._state===AFTER_CDATA_2?this._cbs.oncdata(t):this._state===IN_COMMENT||this._state===AFTER_COMMENT_1||this._state===AFTER_COMMENT_2?this._cbs.oncomment(t):this._state===IN_TAG_NAME?this._cbs.onopentagname(t):this._state===IN_CLOSING_TAG_NAME?this._cbs.onclosetag(t):this._cbs.ontext(t)}this._cbs.onend()};Tokenizer.prototype.reset=function(){Tokenizer.call(this,this._options,this._cbs)};Tokenizer.prototype._emitToken=function(e){this._cbs[e](this._buffer.substring(this._sectionStart,this._index));this._sectionStart=-1};Tokenizer.prototype._emitIfToken=function(e){this._index>this._sectionStart&&this._cbs[e](this._buffer.substring(this._sectionStart,this._index));this._sectionStart=-1};