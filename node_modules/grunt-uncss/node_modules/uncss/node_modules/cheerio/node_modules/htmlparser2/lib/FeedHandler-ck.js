function FeedHandler(e){this.init(e,{ignoreWhitespace:!0})}function getElements(e,t){return DomUtils.getElementsByTagName(e,t,!0)}function getOneElement(e,t){return DomUtils.getElementsByTagName(e,t,!0,1)[0]}function fetch(e,t,n){return DomUtils.getText(DomUtils.getElementsByTagName(e,t,n,1))}var index=require("./index.js"),DomHandler=index.DomHandler,DomUtils=index.DomUtils;require("util").inherits(FeedHandler,DomHandler);FeedHandler.prototype.init=DomHandler;var isValidFeed=function(e){return e==="rss"||e==="feed"||e==="rdf:RDF"};FeedHandler.prototype.onend=function(){var e={},t=getOneElement(isValidFeed,this.dom),n,r;if(t)if(t.name==="feed"){r=t.children;e.type="atom";if(n=fetch("id",r))e.id=n;if(n=fetch("title",r))e.title=n;(n=getOneElement("link",r))&&(n=n.attribs)&&(n=n.href)&&(e.link=n);if(n=fetch("subtitle",r))e.description=n;if(n=fetch("updated",r))e.updated=new Date(n);if(n=fetch("email",r,!0))e.author=n;e.items=getElements("entry",r).map(function(e){var t={},n;e=e.children;if(n=fetch("id",e))t.id=n;if(n=fetch("title",e))t.title=n;(n=getOneElement("link",e))&&(n=n.attribs)&&(n=n.href)&&(t.link=n);if(n=fetch("summary",e))t.description=n;if(n=fetch("updated",e))t.pubDate=new Date(n);return t})}else{r=getOneElement("channel",t.children).children;e.type=t.name.substr(0,3);e.id="";if(n=fetch("title",r))e.title=n;if(n=fetch("link",r))e.link=n;if(n=fetch("description",r))e.description=n;if(n=fetch("lastBuildDate",r))e.updated=new Date(n);if(n=fetch("managingEditor",r))e.author=n;e.items=getElements("item",t.children).map(function(e){var t={},n;e=e.children;if(n=fetch("guid",e))t.id=n;if(n=fetch("title",e))t.title=n;if(n=fetch("link",e))t.link=n;if(n=fetch("description",e))t.description=n;if(n=fetch("pubDate",e))t.pubDate=new Date(n);return t})}this.dom=e;DomHandler.prototype._handleCallback.call(this,t?null:Error("couldn't find root of feed"))};module.exports=FeedHandler;