"use strict";function funescape(e,t,n){var r="0x"+t-65536;return r!==r||n?t:r<0?String.fromCharCode(r+65536):String.fromCharCode(r>>10|55296,r&1023|56320)}function unescapeCSS(e){return e.replace(re_escape,funescape)}function getClosingPos(e){var t=1,n=1,r=e.length;for(;n>0&&t<r;t++)e.charAt(t)==="("?n++:e.charAt(t)===")"&&n--;return t}function parse(e,t){function u(){var t=e.match(re_name)[0];e=e.substr(t.length);return unescapeCSS(t)}function a(){var e=u();if(!t||!t.xmlMode)e=e.toLowerCase();return e}e=(e+"").trimLeft().replace(re_cleanSelector,"$1$2");var n=[],r=[],i,s,o;while(e!=="")if(re_name.test(e))r.push({type:"tag",name:a()});else if(re_ws.test(e)){r.push({type:"descendant"});e=e.trimLeft()}else{s=e.charAt(0);e=e.substr(1);if(s in simpleSelectors)r.push({type:simpleSelectors[s]});else if(s in attribSelectors)r.push({type:"attribute",name:attribSelectors[s][0],action:attribSelectors[s][1],value:u(),ignoreCase:!1});else if(s==="["){i=e.match(re_attr);if(!i)throw new SyntaxError("Malformed attribute selector: "+e);e=e.substr(i[0].length);o=unescapeCSS(i[1]);if(!t||!t.xmlMode)o=o.toLowerCase();r.push({type:"attribute",name:o,action:actionTypes[i[2]],value:unescapeCSS(i[4]||i[5]||""),ignoreCase:!!i[6]})}else if(s===":"){o=a();i=null;if(e.charAt(0)==="("){var f=getClosingPos(e);i=e.substr(1,f-2);e=e.substr(f)}r.push({type:"pseudo",name:o,data:i})}else{if(s!==",")throw new SyntaxError("Unmatched selector: "+s+e);if(r.length===0)throw new SyntaxError("empty sub-selector");n.push(r);r=[]}}if(n.length>0&&r.length===0)throw new SyntaxError("empty sub-selector");n.push(r);return n}module.exports=parse;var re_ws=/^\s/,re_name=/^(?:\\.|[\w\-\u00c0-\uFFFF])+/,re_cleanSelector=/([^\\])\s*([>~+,]|$)\s*/g,re_combinators=/^\s*[^\\]\s*[>~+,]|$\s*/g,re_escape=/\\([\da-f]{1,6}\s?|(\s)|.)/ig,re_comma=/^\s*,\s*/,re_attr=/^\s*((?:\\.|[\w\u00c0-\uFFFF\-])+)\s*(?:(\S?)=\s*(?:(['"])(.*?)\3|(#?(?:\\.|[\w\u00c0-\uFFFF\-])*)|)|)\s*(i)?\]/,actionTypes={__proto__:null,"undefined":"exists","":"equals","~":"element","^":"start",$:"end","*":"any","!":"not","|":"hyphen"},simpleSelectors={__proto__:null,">":"child","<":"parent","~":"sibling","+":"adjacent","*":"universal"},attribSelectors={__proto__:null,"#":["id","equals"],".":["class","element"]};