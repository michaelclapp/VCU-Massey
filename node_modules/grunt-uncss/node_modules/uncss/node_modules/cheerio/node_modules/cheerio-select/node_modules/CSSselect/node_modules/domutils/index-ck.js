function getChildren(e){return e.children}function getParent(e){return e.parent}function getSiblings(e){var t=getParent(e);return t?getChildren(t):[e]}function getAttributeValue(e,t){return e.attribs&&e.attribs[t]}function hasAttrib(e,t){return hasOwnProperty.call(e.attribs,t)}function getName(e){return e.name}function find(e,t,n,r){var i=[],s;for(var o=0,u=t.length;o<u;o++){if(e(t[o])){i.push(t[o]);if(--r<=0)break}s=getChildren(t[o]);if(n&&s&&s.length>0){s=find(e,s,n,r);i=i.concat(s);r-=s.length;if(r<=0)break}}return i}function findOneChild(e,t){for(var n=0,r=t.length;n<r;n++)if(e(t[n]))return t[n];return null}function findOne(e,t){var n=null;for(var r=0,i=t.length;r<i&&!n;r++)e(t[r])?n=t[r]:t[r].children&&t[r].children.length>0&&(n=findOne(e,t[r].children));return n}function findAll(e,t){var n=[];for(var r=0,i=t.length;r<i;r++){e(t[r])&&n.push(t[r]);var s=getChildren(t[r]);s&&s.length&&(n=n.concat(findAll(e,s)))}return n}function filter(e,t,n,r){Array.isArray(t)||(t=[t]);if(typeof r!="number"||!isFinite(r))return n===!1?t.filter(e):findAll(e,t);if(r===1){n===!1?t=findOneChild(e,t):t=findOne(e,t);return t?[t]:[]}return find(e,t,n!==!1,r)}function getAttribCheck(e,t){return typeof t=="function"?function(n){return n.attribs&&t(n.attribs[e])}:function(n){return n.attribs&&n.attribs[e]===t}}function combineFuncs(e,t){return function(n){return e(n)||t(n)}}var ElementType=require("domelementtype"),DomUtils=module.exports;[require("./stringify.js")].forEach(function(e){Object.keys(e).forEach(function(t){DomUtils[t]=e[t]})});var isTag=DomUtils.isTag=ElementType.isTag;DomUtils.getChildren=getChildren;DomUtils.getParent=getParent;DomUtils.getAttributeValue=getAttributeValue;DomUtils.hasAttrib=hasAttrib;DomUtils.getName=getName;DomUtils.getSiblings=getSiblings;DomUtils.findOne=findOne;DomUtils.findAll=findAll;DomUtils.filter=filter;DomUtils.testElement=function(e,t){for(var n in e)if(!!e.hasOwnProperty(n))if(n==="tag_name"){if(!isTag(t)||!e.tag_name(t.name))return!1}else if(n==="tag_type"){if(!e.tag_type(t.type))return!1}else if(n==="tag_contains"){if(isTag(t)||!e.tag_contains(t.data))return!1}else if(!t.attribs||!e[n](t.attribs[n]))return!1;return!0};var Checks={tag_name:function(e){return typeof e=="function"?function(t){return isTag(t)&&e(t.name)}:e==="*"?isTag:function(t){return isTag(t)&&t.name===e}},tag_type:function(e){return typeof e=="function"?function(t){return e(t.type)}:function(t){return t.type===e}},tag_contains:function(e){return typeof e=="function"?function(t){return!isTag(t)&&e(t.data)}:function(t){return!isTag(t)&&t.data===e}}};DomUtils.getElements=function(e,t,n,r){var i=Object.keys(e).map(function(t){var n=e[t];return t in Checks?Checks[t](n):getAttribCheck(t,n)});return i.length===0?[]:filter(i.reduce(combineFuncs),t,n,r)};DomUtils.getElementById=function(e,t,n){Array.isArray(t)||(t=[t]);return findOne(getAttribCheck("id",e),t,n!==!1)};DomUtils.getElementsByTagName=function(e,t,n,r){return filter(Checks.tag_name(e),t,n,r)};DomUtils.getElementsByTagType=function(e,t,n,r){return filter(Checks.tag_type(e),t,n,r)};DomUtils.removeElement=function(e){e.prev&&(e.prev.next=e.next);e.next&&(e.next.prev=e.prev);if(e.parent){var t=e.parent.children;t.splice(t.lastIndexOf(e),1)}};DomUtils.replaceElement=function(e,t){var n=t.prev=e.prev;n&&(n.next=t);var r=t.next=e.next;r&&(r.prev=t);var i=t.parent=e.parent;if(i){var s=i.children;s[s.lastIndexOf(e)]=t}};DomUtils.appendChild=function(e,t){t.parent=e;if(e.children.push(t)!==1){var n=e.children[e.children.length-2];n.next=t;t.prev=n;t.next=null}};DomUtils.append=function(e,t){var n=e.parent,r=e.next;t.next=r;t.prev=e;e.next=t;if(r){r.prev=t;if(n){var i=n.children;i.splice(i.lastIndexOf(r),0,t)}}else n&&n.children.push(t)};DomUtils.prepend=function(e,t){var n=e.parent;if(n){var r=n.children;r.splice(r.lastIndexOf(e),0,t)}e.prev&&(e.prev.next=t);t.prev=e.prev;t.next=e;e.prev=t};