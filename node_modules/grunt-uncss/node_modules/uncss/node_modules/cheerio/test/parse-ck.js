var expect=require("expect.js"),parse=require("../lib/parse"),basic="<html></html>",siblings="<h2></h2><p></p>",single="<br/>",singleWrong="<br>",children="<html><br/></html>",li='<li class="durian">Durian</li>',attributes='<img src="hello.png" alt="man waving">',noValueAttribute="<textarea disabled></textarea>",comment="<!-- sexy -->",conditional='<!--[if IE 8]><html class="no-js ie8" lang="en"><![endif]-->',text="lorem ipsum",script='<script type="text/javascript">alert("hi world!");</script>',scriptEmpty="<script></script>",style='<style type="text/css"> h2 { color:blue; } </style>',styleEmpty="<style></style>",directive="<!doctype html>";describe("parse",function(){describe(".eval",function(){it("should parse basic empty tags: "+basic,function(){var e=parse.evaluate(basic)[0];expect(e.type).to.equal("tag");expect(e.name).to.equal("html");expect(e.children).to.be.empty()});it("should handle sibling tags: "+siblings,function(){var e=parse.evaluate(siblings),t=e[0],n=e[1];expect(e).to.have.length(2);expect(t.name).to.equal("h2");expect(n.name).to.equal("p")});it("should handle single tags: "+single,function(){var e=parse.evaluate(single)[0];expect(e.type).to.equal("tag");expect(e.name).to.equal("br");expect(e.children).to.be.empty()});it("should handle malformatted single tags: "+singleWrong,function(){var e=parse.evaluate(singleWrong)[0];expect(e.type).to.equal("tag");expect(e.name).to.equal("br");expect(e.children).to.be.empty()});it("should handle tags with children: "+children,function(){var e=parse.evaluate(children)[0];expect(e.type).to.equal("tag");expect(e.name).to.equal("html");expect(e.children).to.be.ok();expect(e.children).to.have.length(1)});it("should handle tags with children: "+li,function(){var e=parse.evaluate(li)[0];expect(e.children).to.have.length(1);expect(e.children[0].data).to.equal("Durian")});it("should handle tags with attributes: "+attributes,function(){var e=parse.evaluate(attributes)[0].attribs;expect(e).to.be.ok();expect(e.src).to.equal("hello.png");expect(e.alt).to.equal("man waving")});it("should handle value-less attributes: "+noValueAttribute,function(){var e=parse.evaluate(noValueAttribute)[0].attribs;expect(e).to.be.ok();expect(e.disabled).to.equal("")});it("should handle comments: "+comment,function(){var e=parse.evaluate(comment)[0];expect(e.type).to.equal("comment");expect(e.data).to.equal(" sexy ")});it("should handle conditional comments: "+conditional,function(){var e=parse.evaluate(conditional)[0];expect(e.type).to.equal("comment");expect(e.data).to.equal(conditional.replace("<!--","").replace("-->",""))});it("should handle text: "+text,function(){var e=parse.evaluate(text)[0];expect(e.type).to.equal("text");expect(e.data).to.equal("lorem ipsum")});it("should handle script tags: "+script,function(){var e=parse.evaluate(script)[0];expect(e.type).to.equal("script");expect(e.name).to.equal("script");expect(e.attribs.type).to.equal("text/javascript");expect(e.children).to.have.length(1);expect(e.children[0].type).to.equal("text");expect(e.children[0].data).to.equal('alert("hi world!");')});it("should handle style tags: "+style,function(){var e=parse.evaluate(style)[0];expect(e.type).to.equal("style");expect(e.name).to.equal("style");expect(e.attribs.type).to.equal("text/css");expect(e.children).to.have.length(1);expect(e.children[0].type).to.equal("text");expect(e.children[0].data).to.equal(" h2 { color:blue; } ")});it("should handle directives: "+directive,function(){var e=parse.evaluate(directive)[0];expect(e.type).to.equal("directive");expect(e.data).to.equal("!doctype html");expect(e.name).to.equal("!doctype")})});describe(".connect",function(){var e=function(e){var t=parse.evaluate(e);return parse.connect(t)};it("should fill in empty attributes: "+basic,function(){var t=e(basic)[0];expect(t.parent).to.be(null);expect(t.next).to.be(null);expect(t.prev).to.be(null);expect(t.children).to.be.empty();expect(t.attribs).to.be.ok()});it("should should fill in empty attributes for scripts: "+scriptEmpty,function(){var t=e(scriptEmpty)[0];expect(t.parent).to.be(null);expect(t.next).to.be(null);expect(t.prev).to.be(null);expect(t.children).to.be.empty();expect(t.attribs).to.be.ok()});it("should should fill in empty attributes for styles: "+styleEmpty,function(){var t=e(styleEmpty)[0];expect(t.parent).to.be(null);expect(t.next).to.be(null);expect(t.prev).to.be(null);expect(t.children).to.be.empty();expect(t.attribs).to.be.ok()});it("should have next and prev siblings: "+siblings,function(){var t=e(siblings),n=t[0],r=t[1];expect(n.parent).to.be(null);expect(r.parent).to.be(null);expect(n.next.name).to.equal("p");expect(r.prev.name).to.equal("h2");expect(n.children).to.be.empty();expect(n.attribs).to.be.ok();expect(r.children).to.be.empty();expect(r.attribs).to.be.ok()});it("should connect child with parent: "+children,function(){var t=e(children)[0],n=t.children[0];expect(t.children).to.have.length(1);expect(t.children[0].name).to.equal("br");expect(n.parent.name).to.equal("html")});it("should fill in some empty attributes for comments: "+comment,function(){var t=e(comment)[0];expect(t.parent).to.be(null);expect(t.next).to.be(null);expect(t.prev).to.be(null);expect(t.children).to.not.be.ok();expect(t.attribs).to.not.be.ok()});it("should fill in some empty attributes for text: "+text,function(){var t=e(t)[0];expect(t.parent).to.be(null);expect(t.next).to.be(null);expect(t.prev).to.be(null);expect(t.children).to.not.be.ok();expect(t.attribs).to.not.be.ok()});it("should fill in some empty attributes for directives: "+directive,function(){var t=e(directive)[0];expect(t.parent).to.be(null);expect(t.next).to.be(null);expect(t.prev).to.be(null);expect(t.children).to.not.be.ok();expect(t.attribs).to.not.be.ok()})});describe(".parse",function(){function e(e){expect(e.name).to.equal("root");expect(e.next).to.be(null);expect(e.prev).to.be(null);expect(e.parent).to.be(null);var t=e.children[0];expect(t.parent).to.equal(e)}it("should add root to: "+basic,function(){var t=parse(basic);e(t);expect(t.children).to.have.length(1);expect(t.children[0].name).to.equal("html")});it("should add root to: "+siblings,function(){var t=parse(siblings);e(t);expect(t.children).to.have.length(2);expect(t.children[0].name).to.equal("h2");expect(t.children[1].name).to.equal("p");expect(t.children[1].parent.name).to.equal("root")});it("should add root to: "+comment,function(){var t=parse(comment);e(t);expect(t.children).to.have.length(1);expect(t.children[0].type).to.equal("comment")});it("should add root to: "+text,function(){var t=parse(text);e(t);expect(t.children).to.have.length(1);expect(t.children[0].type).to.equal("text")});it("should add root to: "+scriptEmpty,function(){var t=parse(scriptEmpty);e(t);expect(t.children).to.have.length(1);expect(t.children[0].type).to.equal("script")});it("should add root to: "+styleEmpty,function(){var t=parse(styleEmpty);e(t);expect(t.children).to.have.length(1);expect(t.children[0].type).to.equal("style")});it("should add root to: "+directive,function(){var t=parse(directive);e(t);expect(t.children).to.have.length(1);expect(t.children[0].type).to.equal("directive")})})});