/*
  Module Dependencies
*/var htmlparser=require("htmlparser2"),_=require("underscore"),isTag=require("./utils").isTag,camelCase=require("./utils").camelCase;exports=module.exports=function(e,t){var n=evaluate(e,t),r={type:"root",name:"root",parent:null,prev:null,next:null,children:[]};update(n,r);return r};var evaluate=exports.evaluate=function(e,t){var n=new htmlparser.DomHandler(t),r=new htmlparser.Parser(n,t);r.write(e);r.done();return connect(n.dom)},connect=exports.connect=function(e,t){t=t||null;var n=null;_.each(e,function(e){isTag(e.type)&&(e.attribs===undefined?e.attribs={}:e.data=parseData(e));e.parent=t;e.prev=n;e.next=null;n&&(n.next=e);e.children?connect(e.children,e):isTag(e.type)&&(e.children=[]);n=e});return e},update=exports.update=function(e,t){Array.isArray(e)||(e=[e]);for(var n=0;n<e.length;n++){e[n].prev=e[n-1]||null;e[n].next=e[n+1]||null;e[n].parent=t||null}t.children=e;return t},parseData=exports.parseData=function(e){e.data===undefined&&(e.data={});var t;for(var n in e.attribs)if(n.substr(0,5)==="data-"){t=e.attribs[n];n=n.slice(5);n=camelCase(n);e.data[n]=t}return e.data};