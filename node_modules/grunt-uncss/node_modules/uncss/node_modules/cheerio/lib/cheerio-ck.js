/*
  Module dependencies
*/var path=require("path"),select=require("cheerio-select"),parse=require("./parse"),evaluate=parse.evaluate,updateDOM=parse.update,_=require("underscore"),api=["attributes","traversing","manipulation","css"],quickExpr=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,$=require("./static"),Cheerio=module.exports=function(e,t,n){if(this instanceof Cheerio){if(!e)return this;if(n){typeof n=="string"&&(n=parse(n));this._root=this.make(n,this)}if(e.cheerio)return e;if(e.name||Array.isArray(e))return this.make(e,this);if(typeof e=="string"&&isHtml(e))return this.make(parse(e).children);if(!t)t=this._root;else if(typeof t=="string")if(isHtml(t)){t=parse(t);t=this.make(t,this)}else{e=[t,e].join(" ");t=this._root}return t?t.find(e):this}return new Cheerio(e,t,n)};Cheerio.__proto__=require("./static");Cheerio.prototype.cheerio="[cheerio object]";Cheerio.prototype.options={ignoreWhitespace:!1,xmlMode:!1,lowerCaseTags:!1};Cheerio.prototype.length=0;Cheerio.prototype.sort=[].splice;var isHtml=function(e){if(e.charAt(0)==="<"&&e.charAt(e.length-1)===">"&&e.length>=3)return!0;var t=quickExpr.exec(e);return!!t&&!!t[1]};Cheerio.prototype.make=function(e,t){if(e.cheerio)return e;e=Array.isArray(e)?e:[e];return _.extend(t||new Cheerio,e,{length:e.length})};Cheerio.prototype.toArray=function(){return[].slice.call(this,0)};api.forEach(function(e){_.extend(Cheerio.prototype,require("./api/"+e))});