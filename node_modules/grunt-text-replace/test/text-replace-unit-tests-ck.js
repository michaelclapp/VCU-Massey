var grunt=require("grunt"),fs=require("fs"),gruntTextReplace=require("../lib/grunt-text-replace"),replaceText=function(e,t,n){return gruntTextReplace.replaceText({text:e,replacements:[{from:t,to:n}]})},replaceTextMultiple=function(e,t){return gruntTextReplace.replaceText({text:e,replacements:t})},replaceFile=function(e,t,n){return gruntTextReplace.replaceFile({src:e,dest:t,replacements:n})},replaceFileMultiple=function(e,t,n){return gruntTextReplace.replaceFileMultiple({src:e,dest:t,replacements:n})};exports.textReplace={"Test core replacement functionality":{"Test string replacements":function(e){e.equal(replaceText("Hello world","Hello","Goodbye"),"Goodbye world");e.notEqual(replaceText("Hello w000rld","w0*rld","world"),"Hello world");e.equal(replaceText("Hello (*foo.)","(*foo.)","world"),"Hello world");e.equal(replaceText("Hello \\foo","\\",""),"Hello foo");e.equal(replaceText("Foo bar bar","bar","foo"),"Foo foo foo");e.equal(replaceText("Foo bar bar","bar","Foo bar"),"Foo Foo bar Foo bar");e.done()},"Test regex replacements":function(e){e.equal(replaceText("Hello world",/Hello/,"Goodbye"),"Goodbye world");e.equal(replaceText("Hello world",/(Hello) (world)/,"$2 $1"),"world Hello");e.equal(replaceText("Foo bar bar",/bar/,"foo"),"Foo foo bar");e.equal(replaceText("Foo bar bar",/bar/g,"foo"),"Foo foo foo");e.done()},"Test grunt.template replacements":function(e){e.equal(replaceText("Hello world","world",'<%= grunt.template.date("20 Nov 2012 11:30:00 GMT", "dd/mm/yy") %>'),"Hello 20/11/12");e.done()},"Test function replacements":function(e){e.equal(replaceText("Hello world","world",function(e,t,n,r){return(new Array(4)).join(e)}),"Hello worldworldworld");e.equal(replaceText("Hello world","world",function(e,t,n,r){return t}),"Hello 6");e.equal(replaceText("Hello world","Hello",function(e,t,n,r){return t}),"0 world");e.equal(replaceText("Hello world","foo",function(e,t,n,r){return t}),"Hello world");e.equal(replaceText("Hello world","world",function(e,t,n,r){return n}),"Hello Hello world");e.equal(replaceText("Hello world",/(Hello) (world)/g,function(e,t,n,r){return"Place: "+r[1]+", Greeting: "+r[0]}),"Place: world, Greeting: Hello");e.equal(replaceText("Hello world",/(Hello) (world)/g,function(e,t,n,r){return r[0]+' <%= grunt.template.date("20 Nov 2012 11:30:00 GMT", "dd/mm/yy") %>'}),"Hello 20/11/12");e.done()},"Test multiple replacements":function(e){e.equal(replaceTextMultiple("Hello world",[{from:"Hello",to:"Hi"},{from:"world",to:"planet"}]),"Hi planet");e.done()}},"Test file handling":{setUp:function(e){grunt.file.copy("test/text_files/test.txt","test/temp/testA.txt");grunt.file.copy("test/text_files/test.txt","test/temp/testB.txt");e()},tearDown:function(e){fs.unlinkSync("test/temp/testA.txt");fs.unlinkSync("test/temp/testB.txt");fs.rmdirSync("test/temp");e()},"Test change to file specifying destination file":function(e){var t,n;t=grunt.file.read("test/temp/testA.txt");replaceFile("test/temp/testA.txt","test/temp/testA.txt",[{from:"world",to:"planet"}]);n=grunt.file.read("test/temp/testA.txt");e.equal(t,"Hello world");e.equal(n,"Hello planet");e.done()},"Test change to file specifying destination directory":function(e){var t,n;t=grunt.file.read("test/temp/testA.txt");replaceFile("test/temp/testA.txt","test/temp/",[{from:"world",to:"planet"}]);n=grunt.file.read("test/temp/testA.txt");e.equal(t,"Hello world");e.equal(n,"Hello planet");e.done()},"Test change to multiple files specifying paths":function(e){var t,n,r;t=grunt.file.read("test/temp/testA.txt");replaceFileMultiple(["test/temp/testA.txt","test/temp/testB.txt"],"test/temp/",[{from:"world",to:"planet"}]);n=grunt.file.read("test/temp/testA.txt");r=grunt.file.read("test/temp/testB.txt");e.equal(t,"Hello world");e.equal(n,"Hello planet");e.equal(r,"Hello planet");e.done()},"Test change to multiple files specifying minimatch paths":function(e){var t,n,r;t=grunt.file.read("test/temp/testA.txt");replaceFileMultiple(["test/temp/test*.txt"],"test/temp/",[{from:"world",to:"planet"}]);n=grunt.file.read("test/temp/testA.txt");r=grunt.file.read("test/temp/testB.txt");e.equal(t,"Hello world");e.equal(n,"Hello planet");e.equal(r,"Hello planet");e.done()}}};